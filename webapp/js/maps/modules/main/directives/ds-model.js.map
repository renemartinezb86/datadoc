{"version":3,"sources":["modules/main/directives/ds-model.js"],"names":["define","directives","common","_","joint","angular","directive","$http","$location","$filter","$compile","$q","$sce","$templateCache","$templateRequest","$timeout","$uibModal","HistoryService","WSocket","$localStorage","DatadocService","$state","$stateParams","ViewType","TABLE","LIST","NESTED","fromHistory","restrict","templateUrl","link","$scope","$elm","startFlowStatePolling","taskId","currentTask","post","success","task","flowExecutionState","result","step","steps","each","graph","getElements","cell","state","node","id","view","findView","paper","$box","addClass","progressBar","remainingStr","removeClass","contains","get","complete","percentComplete","toFixed","value","finished","selectedTable","data","indexes","getList","indexToUpdate","findIndex","splice","push","statistics","lastErrorRootCauseMessage","dsErrorTask","content","element","showNotification","isFinished","isCommitRunning","isCancelRunning","committed","Date","error","showError","pushDeleteLinkEvent","item","redo","remove","api","onChange","undo","addToGraph","then","pushDeleteNodeEvent","selectedNode","cid","model","removeHighlight","pushEditJoinSettingsEvent","lastSettings","currentSettings","set","pushMoveNodeEvent","lastCellPosition","currentCellPosition","position","x","y","addHighlight","pushAddNodeEvent","items","isArray","filter","pushDisableFacets","settings","disableFacets","preview","pushSetAsPk","oldPkeyCol","newPkeyCol","pkey","columns","column","pushRemoveErrors","colName","getCurrentSettingsByName","removeErrors","pushCoerceToType","oldType","newType","formatSymbol","decimalPlaces","type","pushSetDataFormat","oldData","newData","refreshPreviewFromCache","pushUpdatePreviewFormat","oldFormat","newFormat","pushUpdateColumnName","oldColName","newColName","find","gridApi","grid","displayName","edited","columnSettings","name","colDef","originalName","rename","pushUpdatePreviewAnnotation","oldAnnotaion","newAnnotaion","annotation","pushUpdateReplaceErrors","oldReplace","newReplace","replaceErrors","pushDeleteReplaceErrors","pushAddTransform","index","isIndexChanged","transformHistory","fillOpsTransformList","pushDeleteTransform","pushEndSortFieldsGrid","oldPos","newPos","colMovable","moveColumn","pushEndResizeColumn","deltaChange","width","hasCustomWidth","core","refresh","pushSelectNode","oldNode","newNode","sourceView","getConnectedLinks","inbound","findViewByModel","getCell","updatePreview","actualSelectedNode","toFront","transforms","createInputSource","u","indexUploads","shapes","html","UnionFolderNode","folderId","InputNode","uploadId","createItem","label","outPorts","itemType","opts","options","merge","delta","size","height","z","hasOutput","e","emtpyGraph","length","isInput","addTo","outPosition","outputNodeOffsetX","nodes","addOutput","out","Link","source","port","target","addCell","showJoinSettingsModal","modelToSwitch","joinSettingsModal","open","scope","animation","addJoinSettings","bottomContainer","joinTypes","join","textContent","$","on","stopPropagation","configureNode","conditions","add","leftKey","rightKey","append","dropNode","event","ui","o","draggable","pageX","offset","left","pageY","top","attr","addJoin","uid","val","getUploadById","addSources","columnsListMenu","isOpen","previewSettings","previewGridOptions","enableColumnResize","columnDefs","pointer","hide","cellView","bbox","getBBox","color","css","heightWithBottomContainer","show","previewWrapper","getJoinNodeInPorts","links","all","getFreePorts","nonAvailablePorts","map","unlimitedInPort","outbound","flatten","ports","idx","baseClass","portView","tryCreateSampleLink","inPorts","connected","outPort","util","getElementBBox","currentPortRect","g","rect","currentPortCenter","center","inPort","availablePortRect","availablePortCenter","distance","linkSampleThreshold","LinkSample","isLink","joinNode","joinNodeBox","joinSettings","copy","leftL","rightL","flowJSON","serializeGraph","rootNode","joinLeftDs","joinRightDs","joinParam","joinType","text","nodeOps","iter","transform","title","toUpperCase","getTransformColumnNames","is","rowTransform","icon","action","columnName","context","col","addTransform","addSeparator","isSeparator","renameColumn","that","focus","convertToListColumn","selected","showConvertToListModal","preserveHistoryColumn","m","showPreserveHistoryModal","annotateColumn","showAnnotationModal","distinctColumn","showDistinctModal","facets","isEnabled","setAsPk","isPk","previousPkeyColumn","formatCurrency","showFormatModal","coerceToFormat","format","setDataFormat","deleteFormats","coerceToType","typeOrAction","oldTypeOrAction","newTypeOrAction","searchType","dataType","showReplaceErrorsModal","getVisibility","removed","getCellTemplate","field","split","params","before","after","filters","preparePreviewData","response","descriptor","editable","rowsCount","rowsExactCount","rowsEstimatedCount","skippedCount","enableNestedView","removedColumns","countBy","true","rows","currentQueryData","cachedPreviewData","cached","currentView","lastColumnDefs","lastPreviewResponse","groupBy","descriptorColumns","sortBy","menuItems","formatSubItems","toLowerCase","subItems","concat","splitOn","preserveHistory","visible","cellClass","unscreen","enableHiding","enableColumnMenu","enableColumnMoving","cellTemplate","refreshCurrentView","createTableView","row","fields","addListCustomFilter","refreshListView","start","listView","currentPagination","maxPerPage","fillListView","refreshNestedView","nestedView","fillNestedView","end","slice","unflatten","makePagination","pagination","Math","ceil","totalSize","i","abs","v","k","path","splitPath","addValueToPath","newTarget","key","m2","has","l","getPreserveHistoryModalSettings","retention","period","selectedPeriod","toJson","toJSON","doPreview","isPreviewRunning","lastPreviewParams","doValidate","isValidationRunning","lastValidateParams","errors","setUnloadRestriction","window","onbeforeunload","min","isModelLoading","onRegisterApi","columnPositionChanged","endSortFieldsGrid","colResizable","columnSizeChanged","endResizeColumn","refreshView","sortFields","endSortFields","oldPosition","newPosition","moveInArray","columnDef","getWarningText","lastPreview","highlightError","toggle","inputNodeOptions","showDsSearch","search","targetNode","viewMode","showDsErrorModal","dsErrorModal","closeDsErrorModal","dismiss","load","newTable","clear","previewRequestId","randomGUID","uploads","graphModel","JSON","parse","fromJSON","cells","getCells","attributes","updateBox","validate","tableId","requestId","cancel","isCommitCancelling","configureRefresh","updateTable","controller","resolve","indexId","refreshSettings","onSuccess","commit","message","resize","workspaceH","setDimensions","us","suppressHistory","createIndex","forEach","sections","s","tmp","JoinNode","fn","addUnion","UnionNode","OutputNode","history","hasPrev","canUndo","hasNext","canRedo","cancelJoinSettings","switchJoin","switchNodeType","joinTypeSelected","availableJoinTypes","addJoinCondition","removeJoinCondition","columnNames","saveJoinSettings","lastIcon","helper","droppable","accept","hoverClass","over","empty","$el","mousedown","drop","Element","basic","Generic","extend","PortsModelInterface","markup","inPortMarkup","outPortMarkup","defaults","deepSupplement","attrs","magnet","stroke","circle","r","fill","prototype","getPortAttrs","portName","total","selector","portSelector","uniqueId","ref","dia","router","startDirections","endDirections","connector","args","radius","toolMarkup","factoryFn","LinkView","updateToolsPosition","_V","labels","scale","getConnectionLength","connectionLength","isNaN","shortLinkLength","toolPosition","getPointAtLength","_toolCache","doubleLinkTools","longLinkLength","doubleLinkToolsOffset","_tool2Cache","LinkSampleView","ElementView","initialize","bindAll","apply","arguments","template","getFullTemplateName","bind","call","removeBox","startOnRowLabel","refreshStartOnRowLabel","rowSpan","startOnRow","$apply","editCsvSettings","upload","editXlsSettings","useHeadersLabel","refreshUseHeadersLabel","useHeaders","render","prepend","update","renderPorts","$inPorts","$outPorts","outPortTemplate","inPortTemplate","p","V","InputNodeView","Array","UnionFolderNodeView","OutputNodeView","JoinNodeView","UnionNodeView","Worksheet","Paper","pointermove","evt","preventDefault","normalizeEvent","localPoint","snapToGrid","clientX","clientY","_mousemoved","trigger","Graph","el","gridSize","linkPinning","snapLinks","interactive","vertexAdd","defaultLink","validateConnection","cellViewS","magnetS","cellViewT","magnetT","linkView","getLinks","classList","getAttribute","validateMagnet","renderContextMenu","lastPosition","targetParentEvent","parentNode","newLink","targetView","hover","off","portNumber","currentOutPorts","availableInPorts","currentInPorts","availableOutPorts","elements","deleteTransform","itemCopy","updateColumnName","keydownColumnName","which","blur","getValueType","wrapArray","selectAllNone","selectAllNoneFields","switchVisibility","appendTo","document","querySelector","toggleMenu","switchPaginate","pag","viewType","dateFormatModalSettings","pattern","showDateFormatModal","originalType","dateFormatModal","closeDateFormatModal","updateDateFormat","replaceErrorsModalSettings","typeNameText","typeNameMappings","replaceErrorsModal","closeReplaceErrorsModal","updateReplaceErrors","deleteReplaceErrors","annotationModalSettings","oldAnnotation","annotationModal","convertToListModalSettings","separator","oldSeparator","convertToListModal","closeConvertToListModal","closePreviewAnnotationModal","updatePreviewAnnotation","deletePreviewAnnotation","updateConvertToList","deleteConvertToList","distinctModalSettings","notSelected","selectedColumn","selectedColumnName","distinctModal","closePreviewDistinctModal","updatePreviewDistinct","formatModalSettings","typeSelected","types","decimalPlacesAvailable","range","formatModal","closePreviewFormatModal","updatePreviewFormat","preserveHistoryModalSettings","ph","preserveHistoryModal","closePreserveHistoryModal","updatePreserveHistory","deletePreserveHistory","renameIndex","closeIndex","go","nameOnly","isUpdating","method","url","reject","elm","html2canvas","onrendered","canvas","contentBBox","getContentBBox","ctx","getContext","x1","y1","x2","y2","errY","errX","cut","getImageData","putImageData","img","toDataURL","previewImage","dropdownMenu","status","mouseOverButton","mouseOverList","close","subscribe","file","$watch","$on","onWorkspaceResize","scrollTop","parseInt","new","replace","select"],"mappings":"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","file":"../../../../modules/main/directives/ds-model.js","sourcesContent":["define(['./module', 'common', 'lodash', 'joint', 'angular', 'angular-sortable-view', 'ui-grid-move-columns'], function (directives, common, _, joint, angular) {\n    'use strict';\n\n    directives.directive('dsModel', ['$http', '$location', '$filter', '$compile', '$q', '$sce', '$templateCache', '$templateRequest', '$timeout', '$uibModal', 'HistoryService', 'WSocket', '$localStorage', 'DatadocService', '$state', '$stateParams', 'gridUtil', 'uiGridColumnMenuService', function ($http, $location, $filter, $compile, $q, $sce, $templateCache, $templateRequest, $timeout, $uibModal, HistoryService, WSocket, $localStorage, DatadocService, $state, $stateParams, gridUtil, uiGridColumnMenuService) {\n\n        var ViewType = {\n            TABLE: 0,\n            LIST: 1,\n            NESTED: 2\n        };\n\n        var fromHistory = false;\n\n        return {\n            restrict: 'A',\n            templateUrl: 'static/templates/include/ds-model.html',\n            link: function ($scope, $elm, $attr) {\n                $scope.ViewType = ViewType;\n                $scope.isModelLoading = false;\n                var graph, paper,\n                    outputNodeOffsetX = 200;\n                $scope.previewGridOptions = {\n                    enableColumnResize: true,\n                    columnDefs: [],\n                    data: [],\n                    onRegisterApi: function(gridApi) {\n                        $scope.gridApi = gridApi;\n                        // move field for display in settings\n                        gridApi.colMovable.on.columnPositionChanged($scope, $scope.endSortFieldsGrid);\n                        gridApi.colResizable.on.columnSizeChanged($scope, $scope.endResizeColumn);\n                    }\n                };\n\n                var refreshView = function(){\n                    if($scope.currentView == ViewType.LIST) {\n                        refreshListView();\n                    } else if($scope.currentView == ViewType.NESTED) {\n                        refreshNestedView();\n                    } else {\n                        $scope.gridApi.core.refresh();\n                        $scope.gridApi.grid.refresh();\n                    }\n                };\n\n                var sortFields = false;\n                $scope.endSortFields = function (oldPosition, newPosition) {\n                    sortFields = true; // because \"moveColumn\" calls \"endSortFieldsGrid\" as callback\n                    $scope.gridApi.colMovable.moveColumn(oldPosition, newPosition);\n                    refreshView();\n                };\n\n                $scope.endSortFieldsGrid = function (colDef, oldPos, newPos) {\n                    if (!sortFields) {\n                        common.moveInArray($scope.previewGridOptions.columnDefs, oldPos, newPos);\n                    }\n                    _.each($scope.previewGridOptions.columnDefs, function(columnDef, index){\n                        var settings = _.find($scope.selectedNode.model.get('settings').columns, function(col){\n                            return col.name == columnDef.originalName;\n                        });\n                        if(settings) settings.index = index;\n                    });\n                    sortFields = false;\n\n                    if (!fromHistory) {\n                        pushEndSortFieldsGrid(oldPos, newPos);\n                    }\n                    fromHistory = false;\n\n                };\n\n                $scope.endResizeColumn = function (colDef, deltaChange) {\n                    if (!fromHistory) {\n                        pushEndResizeColumn(colDef.originalName, deltaChange);\n                    }\n                    fromHistory = false;\n                };\n\n                var indexUploads = {};\n                $scope.errors = [];\n                $scope.getWarningText = function(){\n                    return $scope.errors.length + \" warning\" + ($scope.errors.length > 1 ? 's' : '');\n                };\n                $scope.flowExecutionState = {};\n\n                $scope.isPreviewRunning = false;\n                $scope.isValidationRunning = false;\n                $scope.lastPreview = undefined;\n                $scope.isCommitRunning = false;\n                $scope.isIndexChanged = false;\n                $scope.currentTask = undefined;\n\n                $scope.highlightError = function(id, toggle){\n                    if(id) {\n                        var model = graph.getCell(id);\n                        if (model) {\n                            var view = model.findView(paper);\n                            if (toggle) {\n                                view.$box.addClass('hltd-error');\n                            } else {\n                                view.$box.removeClass('hltd-error');\n                            }\n                        }\n                    }\n                };\n\n                $scope.inputNodeOptions = function(){\n                    return [\n                        [\"Reveal Source\", function(scope, e) {\n                            $scope.showDsSearch();\n                            $scope.search(e.targetNode.model.get('view').label);\n                        }],\n                        [\"Remove Source\", function(scope, e) {\n                            e.targetNode.model.remove();\n                        }]\n                    ];\n                };\n\n                $scope.progressBar = {\n                    remainingStr: '',\n                    value: 0,\n                    step: 0,\n                    steps: 0,\n                    viewMode: function(){\n                        $scope.viewMode = true;\n                    }\n                };\n                function startFlowStatePolling(taskId){\n                    $scope.currentTask = taskId;\n                    $http.post('/api/flow/get_state', {taskId: taskId})\n                        .success(function(task){\n                            $scope.flowExecutionState = task.result;\n                            var step = 0;\n                            var steps = 0;\n                            _.each(graph.getElements(), function(cell){\n                                if(task.result && task.result.state) {\n                                    var node = task.result.state[cell.id];\n                                    steps++;\n                                    if (node) {\n                                        var view = cell.findView(paper);\n                                        if(node.state == 'FINISHED'){\n                                            view.$box.addClass('finished');\n                                            $scope.progressBar.remainingStr = '';\n                                            step++;\n                                        }\n                                        else if (node.state == 'RUNNING') {\n                                            view.$box.addClass('running');\n                                            if(_.contains(['html.OutputNode', 'html.JoinNode'], cell.get('type'))){\n                                                //view.$box.find('.progress-container').show();\n                                                var complete = (node.percentComplete ? node.percentComplete.toFixed(0) : 0);\n\n                                                // todo dev estimate checker\n                                                // var remainingStr = common.estimateRemainingTime($scope.progressBar.value, complete, 2000);\n                                                // if (remainingStr) {\n                                                //     $scope.progressBar.remainingStr = remainingStr;\n                                                // }\n\n                                                $scope.progressBar.value = complete;\n\n\n                                                //view.$box.find('.progress-container .progress-bar').css('width', complete);\n                                                //view.$box.find('.progress-container .percent').text(complete)\n                                            }\n                                        } else {\n                                            view.$box.removeClass('running');\n                                            //view.$box.find('.progress-container').hide();\n                                        }\n                                    }\n                                }\n                            });\n                            if(step < steps) step++;\n                            $scope.progressBar.step = step;\n                            $scope.progressBar.steps = steps;\n\n                            if(task.finished){\n                                $http.get('/api/tables/' + $scope.selectedTable.id)\n                                    .success(function(data){\n                                        var indexes = DatadocService.getList(),\n                                            indexToUpdate = _.findIndex(indexes, {id: data.id});\n                                        if(indexToUpdate){\n                                            indexes.splice(indexToUpdate, 1, data);\n                                        } else {\n                                            DatadocService.push(data);\n                                        }\n                                        $timeout(function(){\n                                            if(task.statistics.lastErrorRootCauseMessage){\n                                                $scope.dsErrorTask = task;\n                                                var content = $compile(angular.element(\n                                                        \"<div>{{dsErrorTask.statistics.lastErrorRootCauseMessage | limitTo : 100}}<br/>\" +\n                                                        \"<a ng-click='showDsErrorModal()'>Details...</a></div>\")\n                                                )($scope);\n                                                common.showNotification(content[0], 'error', 0)\n                                            } else {\n                                                $scope.progressBar.isFinished = true;\n                                            }\n                                            $scope.isCommitRunning = false;\n                                            $scope.isCancelRunning = false;\n                                            $scope.progressBar.step = 0;\n                                            $scope.progressBar.steps = 0;\n                                            $scope.progressBar.value = 0;\n                                            $scope.selectedTable.committed = new Date();\n                                            _.each(graph.getElements(), function(cell){\n                                                var view = cell.findView(paper);\n                                                view.$box.removeClass('finished');\n                                                view.$box.removeClass('running');\n                                                //view.$box.find('.progress-container').hide();\n                                            });\n                                        });\n                                    })\n                            } else {\n                                $timeout(function(){\n                                    startFlowStatePolling(taskId);\n                                }, 2000)\n                            }\n                        })\n                        .error(common.showError)\n                }\n                $scope.showDsErrorModal = function(message, stacktrace){\n                    $scope.dsErrorModal = $uibModal.open({\n                        templateUrl: 'static/templates/include/ds-error.html',\n                        scope: $scope,\n                        animation: true,\n                        size: 'md'\n                    })\n                };\n                $scope.closeDsErrorModal = function(){\n                    $scope.dsErrorModal.dismiss();\n                };\n\n                $scope.api = {\n                    load: function(newTable){\n                        graph.clear();\n                        HistoryService.clear();\n\n                        $scope.errors = [];\n                        indexUploads = {};\n                        previewRequestId = common.randomGUID();\n                        _.each(newTable.uploads, function(u){\n                            indexUploads[u.id] = u;\n                        });\n                        if(newTable.flowJSON == null){\n                            return true;\n                        }\n                        $scope.isModelLoading = true;\n                        var graphModel = JSON.parse(newTable.flowJSON);\n                        $timeout(function(){\n                            graph.fromJSON(graphModel);\n                            var cells = graph.getCells();\n                            _.each(cells, function(cell){\n                                var model = graph.getCell(cell.attributes.id);\n                                var settings = cell.attributes.settings;\n                                var view = model.findView(paper).$box;\n                                if (!_.contains(['html.Link', 'html.OutputNode'], cell.attributes.type)){\n                                    if(cell.get('type') == 'html.InputNode'){\n                                        var u = indexUploads[cell.get('settings').uploadId];\n                                        if(u) {\n                                            cell.get('view').label = u.name;\n                                            cell.findView(paper).updateBox();\n                                        }\n                                    }\n                                    fillOpsTransformList(view, model.get('settings').transforms);\n                                }\n                                if(cell.attributes.type == 'html.JoinNode'){\n                                    addJoinSettings(settings, model, view);\n                                }\n                            });\n                            $scope.api.validate();\n                            $scope.isModelLoading = false;\n                        });\n\n                        $http.post('/api/flow/get_active_task', {tableId: newTable.id})\n                            .success(function(task){\n                                if(task){\n                                    $scope.isCommitRunning = true;\n                                    startFlowStatePolling(task.id);\n                                }\n                            })\n                            .error(common.showError);\n\n                        return true;\n                    },\n                    onChange: function(){\n                        if($scope.selectedTable && $scope.selectedTable.committed)\n                            $scope.isIndexChanged = true;\n                        $scope.progressBar.isFinished = false;\n                        setUnloadRestriction();\n                        $scope.api.validate();\n                    },\n                    validate: function(){\n                        $scope.lastValidateParams = {flowJSON: serializeGraph()};\n                        doValidate();\n                    },\n                    preview: function(){\n                        $scope.lastPreviewParams = {requestId: previewRequestId, flowJSON: serializeGraph(), rootNode: $scope.selectedNode.model.id};\n                        doPreview();\n                    },\n                    cancel: function(){\n                        $http.post('/api/flow/cancel', {taskId: $scope.currentTask})\n                            .success(function(){\n                                $scope.isCommitCancelling = true;\n                            })\n                    },\n                    configureRefresh: function(){\n                        $scope.updateTable().then(function(){\n                            $uibModal.open({\n                                controller: 'refreshSettingsCtrl',\n                                templateUrl: 'static/templates/include/refresh-settings.html',\n                                resolve: {\n                                    indexId: function(){\n                                        return $scope.selectedTable.id\n                                    },\n                                    refreshSettings: function(){\n                                        return angular.copy($scope.selectedTable.refreshSettings);\n                                    },\n                                    onSuccess: function(){\n                                        return function(result){\n                                            $scope.selectedTable.refreshSettings = result;\n                                        }\n                                    }\n                                }\n                            })\n                        })\n                    },\n                    commit: function(){\n                        if(!$scope.selectedTable\n                            || !$scope.selectedTable.id){\n                            common.showError({message: 'Please select index or create new one'});\n                            return;\n                        }\n                        $scope.isCommitRunning = true;\n\n                        $scope.updateTable().then(function(){\n                            $http.post('/api/flow/execute', {tableId: $scope.selectedTable.id})\n                                .success(function(taskId){\n                                    startFlowStatePolling(taskId);\n                                    $scope.isIndexChanged = false;\n                                    setUnloadRestriction();\n                                })\n                                .error(function(e){\n                                    common.showError(e);\n                                    $scope.isCommitRunning = false;\n                                    $scope.isCancelRunning = false;\n                                })\n                        })\n                    },\n                    clear: function(){\n                        graph.clear();\n                    },\n                    resize: function(height){\n                        if(!height){\n                            height = $localStorage.workspaceH;\n                        }\n                        if(!height || height < 400){\n                            height = 400;\n                        }\n                        if(paper) {\n                            paper.setDimensions($elm.find('#worksheet').width(), height);\n                        }\n                    },\n                    nodes: {\n                        addSources: function(us, position, suppressHistory){\n                            if(!$scope.selectedTable){\n                                $scope.createIndex();\n                            }\n                            var items = [];\n                            _.forEach(us, function(u){\n                                if(u.type == 'composite-ds'){\n                                    _.forEach(u.sections, function(s){\n                                        var item = createInputSource(s, position);\n                                        items.push(item);\n                                    })\n                                } else if(u.type == 'ds' || u.type === 'section-ds' || u.type == 'folder') {\n                                    var item = createInputSource(u, position);\n                                    items.push(item);\n                                }\n                            });\n                            return $q.all(_.map(items, function(item){\n                                return addToGraph(item);\n                            })).then(function(items){\n                                var tmp = [];\n                                _.each(items, function(i){\n                                    if(_.isArray(i)){\n                                        tmp = tmp.concat(i);\n                                    } else {\n                                        tmp.push(i);\n                                    }\n                                });\n                                if(!suppressHistory) {\n                                    pushAddNodeEvent(tmp);\n                                    $scope.api.onChange();\n                                }\n                                return tmp;\n                            });\n                        },\n                        addJoin: function(position, suppressHistory){\n                            var item = createItem(joint.shapes.html.JoinNode, {}, {\n                                '@class': '.JoinNodeSettings',\n                                conditions: [{leftKey: undefined, fn: 'EQ', rightKey: undefined}],\n                                transforms: [],\n                                columns: []\n                            }, {\n                                position: position,\n                                inPorts: ['in1','in2'],\n                                outPorts: ['out']\n                            });\n                            return addToGraph(item).then(function(item){\n                                if(!suppressHistory) {\n                                    $scope.api.onChange();\n                                    pushAddNodeEvent(item);\n                                }\n                                return item;\n                            });\n                        },\n\n                        addUnion : function(position, suppressHistory){\n                            var item = createItem(joint.shapes.html.UnionNode, {}, {\n                                '@class': '.UnionNodeSettings',\n                                transforms: [],\n                                columns: []\n                            },{\n                                position: position,\n                                inPorts: ['in1'],\n                                outPorts: ['out']\n                            });\n                            return addToGraph(item).then(function(item){\n                                if(!suppressHistory) {\n                                    $scope.api.onChange();\n                                    pushAddNodeEvent(item);\n                                }\n                                return item;\n                            });\n                        },\n\n                        addOutput : function(position, tableId){\n                            var item = createItem(joint.shapes.html.OutputNode, {}, {\n                                '@class': '.OutputNodeSettings',\n                                tableId: tableId,\n                                transforms: [],\n                                columns: []\n                            }, {\n                                inPorts: ['in1'],\n                                position: position\n                            });\n                            return addToGraph(item);\n                        }\n                    },\n                    history : {\n                        hasPrev: function(){\n                            return HistoryService.canUndo();\n                        },\n                        hasNext: function(){\n                            return HistoryService.canRedo();\n                        },\n                        undo : function(){\n                            return HistoryService.undo();\n                        },\n                        redo : function(){\n                            return HistoryService.redo();\n                        }\n                    }\n                };\n\n                function pushDeleteLinkEvent(item){\n                    HistoryService.push({\n                        redo: function () {\n                            item.remove();\n                            $scope.api.onChange();\n                        },\n                        undo: function () {\n                            addToGraph(item).then(function(){\n                                $scope.api.onChange();\n                            });\n                        }\n                    })\n                }\n\n                function pushDeleteNodeEvent(item){\n                    HistoryService.push({\n                        redo: function(){\n                            if($scope.selectedNode && item.cid == $scope.selectedNode.model.cid)\n                                removeHighlight();\n                            item.remove();\n                            $scope.api.onChange();\n                        },\n                        undo: function(){\n                            addToGraph(item).then(function(){\n                                $scope.api.onChange();\n                            });\n                        }\n                    });\n                }\n\n                function pushEditJoinSettingsEvent(item, lastSettings, currentSettings){\n                    HistoryService.push({\n                        undo: function(){\n                            item.set('settings', lastSettings);\n                            $scope.api.onChange();\n                        },\n                        redo: function(){\n                            item.set('settings', currentSettings);\n                            $scope.api.onChange();\n                        }\n                    });\n                }\n\n                function pushMoveNodeEvent(item, lastCellPosition, currentCellPosition){\n                    HistoryService.push({\n                        undo: function () {\n                            item.model.position(lastCellPosition.x, lastCellPosition.y);\n                            addHighlight(item);\n                        },\n                        redo: function () {\n                            item.model.position(currentCellPosition.x, currentCellPosition.y);\n                            addHighlight(item);\n                        }\n                    });\n                }\n\n                function pushAddNodeEvent(items){\n                    items = _.isArray(items) ? _.filter(items, function(item){ return item.get('type') != 'html.OutputNode'}) : [items];\n                    HistoryService.push({\n                        undo: function () {\n                            _.each(items, function (item) {\n                                item.remove()\n                            })\n                        },\n                        redo: function () {\n                            _.each(items, function (item) {\n                                addToGraph(item).then(function(){\n                                    $scope.api.onChange();\n                                })\n                            })\n                        }\n                    });\n                }\n\n                function pushDisableFacets(settings) {\n                    HistoryService.push({\n                        redo: function () {\n                            settings.disableFacets = !settings.disableFacets;\n                            $scope.api.preview();\n                        },\n                        undo: function () {\n                            settings.disableFacets = !settings.disableFacets;\n                            $scope.api.preview();\n                        }\n                    });\n                }\n\n                function pushSetAsPk(oldPkeyCol, newPkeyCol) {\n                    HistoryService.push({\n                        redo: function () {\n                            if(!newPkeyCol.pkey) {\n                                var columns = $scope.selectedNode.model.get('settings').columns;\n                                _.each(columns, function (column) {\n                                    column.pkey = false\n                                });\n                            }\n                            newPkeyCol.pkey = !newPkeyCol.pkey;\n                            $scope.api.preview();\n                        },\n                        undo: function () {\n\n                            var columns = $scope.selectedNode.model.get('settings').columns;\n                            _.each(columns, function (column) {\n                                column.pkey = false\n                            });\n\n                            if (oldPkeyCol) {\n                                oldPkeyCol.pkey = !oldPkeyCol.pkey;\n                            }\n                            $scope.api.preview();\n                        }\n                    });\n                }\n\n                function pushRemoveErrors(colName) {\n                    HistoryService.push({\n                        redo: function () {\n                            var settings = getCurrentSettingsByName(colName);\n                            settings.removeErrors = !settings.removeErrors;\n                            $scope.api.preview();\n                        },\n                        undo: function () {\n                            var settings = getCurrentSettingsByName(colName);\n                            settings.removeErrors = !settings.removeErrors;\n                            $scope.api.preview();\n                        }\n                    });\n                }\n\n                function pushCoerceToType(colName, oldType, newType) {\n                    HistoryService.push({\n                        redo: function () {\n                            var settings = getCurrentSettingsByName(colName);\n\n                            settings.filter = null;\n                            settings.formatSymbol = null;\n                            settings.decimalPlaces = null;\n                            if (typeof newType === \"function\") {\n                                newType(settings);\n                            } else {\n                                settings.type = newType;\n                                $scope.api.preview();\n                            }\n                        },\n                        undo: function () {\n                            var settings = getCurrentSettingsByName(colName);\n\n                            settings.filter = null;\n                            settings.formatSymbol = null;\n                            settings.decimalPlaces = null;\n                            if (typeof oldType === \"function\") {\n                                oldType(settings);\n                            } else {\n                                settings.type = oldType;\n                                $scope.api.preview();\n                            }\n                        }\n                    });\n                }\n\n                function pushSetDataFormat(colName, oldData, newData) {\n                    HistoryService.push({\n                        redo: function () {\n                            var settings = getCurrentSettingsByName(colName);\n\n                            settings.filter = newData.filter;\n                            settings.decimalPlaces = newData.decimalPlaces;\n\n                            refreshPreviewFromCache();\n                        },\n                        undo: function () {\n                            var settings = getCurrentSettingsByName(colName);\n\n                            settings.filter = oldData.filter;\n                            settings.decimalPlaces = oldData.decimalPlaces;\n\n                            refreshPreviewFromCache();\n                        }\n                    });\n                }\n\n                function pushUpdatePreviewFormat(colName, oldFormat, newFormat) {\n                    HistoryService.push({\n                        redo: function () {\n                            var settings = getCurrentSettingsByName(colName);\n\n                            settings.formatSymbol = newFormat.formatSymbol;\n                            settings.decimalPlaces = newFormat.decimalPlaces;\n                            settings.filter = newFormat.filter;\n                            refreshPreviewFromCache();\n                        },\n                        undo: function () {\n                            var settings = getCurrentSettingsByName(colName);\n\n                            settings.formatSymbol = oldFormat.formatSymbol;\n                            settings.decimalPlaces = oldFormat.decimalPlaces;\n                            settings.filter = oldFormat.filter;\n                            refreshPreviewFromCache();\n                        }\n                    });\n                }\n\n                function pushUpdateColumnName(oldColName, newColName) {\n                    HistoryService.push({\n                        redo: function () {\n                            var column = _.find($scope.gridApi.grid.columns, {displayName: oldColName});\n                            column.edited = false;\n                            var columnSettings = _.find($scope.selectedNode.model.get('settings').columns, {name: column.colDef.originalName});\n                            columnSettings.rename = newColName;\n                            column.displayName = newColName;\n                            $scope.api.preview();\n                        },\n                        undo: function () {\n                            var column = _.find($scope.gridApi.grid.columns, {displayName: newColName});\n                            column.edited = false;\n                            var columnSettings = _.find($scope.selectedNode.model.get('settings').columns, {name: column.colDef.originalName});\n                            columnSettings.rename = oldColName;\n                            column.displayName = oldColName;\n                            $scope.api.preview();\n                        }\n                    });\n                }\n\n                function pushUpdatePreviewAnnotation(colName, oldAnnotaion, newAnnotaion) {\n                    HistoryService.push({\n                        redo: function () {\n                            var settings = getCurrentSettingsByName(colName);\n                            settings.annotation = newAnnotaion;\n                            refreshPreviewFromCache();\n                        },\n                        undo: function () {\n                            var settings = getCurrentSettingsByName(colName);\n                            settings.annotation = oldAnnotaion;\n                            refreshPreviewFromCache();\n                        }\n                    });\n\n                }\n\n                function pushUpdateReplaceErrors(colName, oldReplace, newReplace) {\n                    HistoryService.push({\n                        redo: function () {\n                            var settings = getCurrentSettingsByName(colName);\n                            settings.replaceErrors = newReplace;\n                            $scope.api.preview();\n                        },\n                        undo: function () {\n                            var settings = getCurrentSettingsByName(colName);\n                            settings.replaceErrors = oldReplace;\n                            $scope.api.preview();\n                        }\n                    });\n                }\n\n                function pushDeleteReplaceErrors(colName, oldReplace, newReplace) {\n                    HistoryService.push({\n                        redo: function () {\n                            var settings = getCurrentSettingsByName(colName);\n                            settings.replaceErrors = newReplace;\n                            $scope.api.preview();\n                        },\n                        undo: function () {\n                            var settings = getCurrentSettingsByName(colName);\n                            settings.replaceErrors = oldReplace;\n                            $scope.api.preview();\n                        }\n                    });\n                }\n\n                function pushAddTransform(item, index) {\n                    HistoryService.push({\n                        redo: function () {\n                            if(!$scope.isIndexChanged)\n                                $scope.isIndexChanged = true;\n                            $scope.transformHistory.push(item);\n                            fillOpsTransformList($scope.selectedNode.$box, $scope.transformHistory);\n                            $scope.api.preview();\n                        },\n                        undo: function () {\n                            if(!$scope.isIndexChanged)\n                                $scope.isIndexChanged = true;\n                            $scope.transformHistory.splice(index, 1);\n                            fillOpsTransformList($scope.selectedNode.$box, $scope.transformHistory);\n                            $scope.api.preview();\n                        }\n                    });\n                }\n\n                function pushDeleteTransform(item, index) {\n                    HistoryService.push({\n                        redo: function () {\n                            // delete transform\n                            if(!$scope.isIndexChanged)\n                                $scope.isIndexChanged = true;\n                            $scope.transformHistory.splice(index, 1);\n                            fillOpsTransformList($scope.selectedNode.$box, $scope.transformHistory);\n                            $scope.api.preview();\n\n                        },\n                        undo: function () {\n                            // add transform\n                            if(!$scope.isIndexChanged)\n                                $scope.isIndexChanged = true;\n                            $scope.transformHistory.push(item);\n                            fillOpsTransformList($scope.selectedNode.$box, $scope.transformHistory);\n                            $scope.api.preview();\n                        }\n                    });\n                }\n\n                function pushEndSortFieldsGrid(oldPos, newPos) {\n                    HistoryService.push({\n                        redo: function () {\n                            fromHistory = true;\n                            $scope.gridApi.colMovable.moveColumn(oldPos, newPos);\n                        },\n                        undo: function () {\n                            fromHistory = true;\n                            $scope.gridApi.colMovable.moveColumn(newPos, oldPos);\n                        }\n                    });\n                }\n\n                function pushEndResizeColumn(colName, deltaChange) {\n                    HistoryService.push({\n                        redo: function () {\n                            fromHistory = true;\n\n                            var column = _.find($scope.gridApi.grid.columns, {displayName: colName});\n                            column.width = column.width + deltaChange;\n                            column.hasCustomWidth = true;\n\n                            $scope.gridApi.core.refresh();\n                            $scope.gridApi.grid.refresh();\n                        },\n                        undo: function () {\n                            fromHistory = true;\n\n                            var column = _.find($scope.gridApi.grid.columns, {displayName: colName});\n                            column.width = column.width + (~deltaChange + 1);\n                            column.hasCustomWidth = true;\n\n                            $scope.gridApi.core.refresh();\n                            $scope.gridApi.grid.refresh();\n                        }\n                    });\n                }\n\n                function pushSelectNode(oldNode, newNode) {\n                    HistoryService.push({\n                        redo: function () {\n                            if (!newNode) return;\n\n                            var sourceView;\n                            if (newNode.model.get('type') == 'html.OutputNode') {\n                                var link = graph.getConnectedLinks(newNode.model, {inbound: true})[0];\n                                if(link)\n                                    sourceView = paper.findViewByModel(graph.getCell(link.get('source').id));\n                            }\n                            $scope.selectedNode = (sourceView || newNode);\n                            var updatePreview = actualSelectedNode == null || newNode.model.id != actualSelectedNode.model.id;\n                            actualSelectedNode = newNode;\n                            newNode.model.toFront();\n                            if(updatePreview) {\n\n                                removeHighlight();\n                                addHighlight(newNode);\n                                if($scope.selectedNode.model.get('type') != 'html.OutputNode') {\n                                    $scope.transformHistory = $scope.selectedNode.model.get('settings').transforms;\n                                    fillOpsTransformList($scope.selectedNode.$box, $scope.transformHistory);\n                                }\n                                $scope.api.preview();\n                            }\n                        },\n                        undo: function () {\n                            if (!oldNode) return;\n\n                            var sourceView;\n                            if (oldNode.model.get('type') == 'html.OutputNode') {\n                                var link = graph.getConnectedLinks(oldNode.model, {inbound: true})[0];\n                                if(link)\n                                    sourceView = paper.findViewByModel(graph.getCell(link.get('source').id));\n                            }\n                            $scope.selectedNode = (sourceView || oldNode);\n                            var updatePreview = actualSelectedNode == null || oldNode.model.id != actualSelectedNode.model.id;\n                            actualSelectedNode = oldNode;\n                            oldNode.model.toFront();\n                            if(updatePreview) {\n\n                                removeHighlight();\n                                addHighlight(oldNode);\n                                if($scope.selectedNode.model.get('type') != 'html.OutputNode') {\n                                    $scope.transformHistory = $scope.selectedNode.model.get('settings').transforms;\n                                    fillOpsTransformList($scope.selectedNode.$box, $scope.transformHistory);\n                                }\n                                $scope.api.preview();\n                            }\n                        }\n                    });\n                }\n\n                function createInputSource(u, position){\n                    var type, settings;\n                    indexUploads[u.id] = u;\n                    if(u.type == 'folder') {\n                        type = joint.shapes.html.UnionFolderNode;\n                        settings = {\n                            '@class': '.UnionFolderNodeSettings',\n                            folderId: u.id,\n                            transforms: [],\n                            columns: []\n                        }\n                    } else {\n                        type = joint.shapes.html.InputNode;\n                        settings = {\n                            '@class': '.InputNodeSettings',\n                            uploadId: u.id,\n                            transforms: [],\n                            columns: []\n                        }\n                    }\n                    return createItem(type, {label: u.name}, settings, {\n                        position: position,\n                        outPorts: ['out']\n                    });\n                }\n\n                var delta = 0;\n                function createItem(itemType, view, settings, opts){\n                    var options = _.merge({\n                        position: { x: 100 + delta, y: 100 + delta },\n                        size: { width: 75, height: 75 },\n                        view: view,\n                        settings: settings,\n                        z: delta\n                    }, opts);\n                    delta += 20;\n                    if(delta > 150){\n                        delta = 0;\n                    }\n                    return new itemType(options);\n                }\n\n                function addToGraph(item){\n                     var hasOutput = _.find(graph.getElements(), function(e){\n                        return e.get('type') == 'html.OutputNode';\n                    });\n                    var emtpyGraph = graph.getElements().length == 0;\n                    var isInput = item.get('type') == 'html.InputNode';\n                    return $timeout(function(){\n                        item.addTo(graph);\n                        item.toFront();\n                        if(isInput && !hasOutput) {\n                            var outPosition = {x: item.position().x + outputNodeOffsetX, y: item.position().y};\n                            return $scope.api.nodes.addOutput(outPosition, $scope.selectedTable.id).then(function (out) {\n                                if(emtpyGraph) {\n                                    var link = new joint.shapes.html.Link({\n                                        source: {\n                                            id: item.id,\n                                            port: 'out'\n                                        },\n                                        target: {\n                                            id: out.id,\n                                            port: 'in1'\n                                        }\n                                    });\n                                    graph.addCell(link);\n                                    $scope.api.onChange();\n                                    return [item, out];\n                                 }\n                               });\n                        } else {\n                            return item;\n                        }\n                    });\n                }\n\n                var modelToSwitch;\n                function showJoinSettingsModal(model){\n                    modelToSwitch = model;\n                    $scope.joinSettingsModal = $uibModal.open({\n                        templateUrl: 'static/templates/include/join-settings.html;',\n                        scope: $scope,\n                        animation: true,\n                        size: 'lg'\n                    });\n                }\n                $scope.cancelJoinSettings = function(){\n                    $scope.joinSettingsModal.dismiss();\n                };\n                $scope.switchJoin = function(){\n                    $scope.switchNodeType(modelToSwitch);\n                    $scope.joinSettingsModal.dismiss();\n                };\n                $scope.joinTypeSelected = function(){\n                    switch($scope.joinType){\n                        case 'JOIN':\n                            $scope.joinParam = {type: 'join'};\n                            break;\n                        case 'UNION':\n                            $scope.joinParam = {type: 'union', text: 'Fields will be added together based on fields name.'};\n                            break;\n                    }\n                };\n\n                $scope.availableJoinTypes = ['JOIN', 'UNION'];\n                $scope.joinType = undefined;\n                $scope.joinTypes = [\n                    {name: \"INNER JOIN\", value: 'INNER'},\n                    {name: \"LEFT OUTER JOIN\", value: 'LEFT_OUTER'},\n                    {name: \"RIGHT OUTER JOIN\", value: 'RIGHT_OUTER'},\n                    {name: \"FULL OUTER JOIN\", value: 'FULL_OUTER'}\n                ];\n\n                // todo ????\n                $scope.joinLeftDs = [];\n                $scope.joinRightDs = [];\n                $scope.joinSettings = undefined;\n                $scope.joinNode = undefined;\n                $scope.joinNodeBox = undefined;\n                $scope.addJoinCondition = function(){\n                    $scope.joinSettings.conditions.push({leftKey: undefined, fn: 'EQ', rightKey: undefined})\n                };\n                $scope.removeJoinCondition = function(idx){\n                    $scope.joinSettings.conditions.splice(idx, 1);\n                };\n                $scope.getTransformColumnNames = function(transform){\n                    return transform.columnName ? common.unscreen(transform.columnName) : _.map(transform.columnNames, common.unscreen).join(', ');\n                };\n                $scope.saveJoinSettings = function(){\n                    if(modelToSwitch != $scope.joinNode){\n                        $scope.switchNodeType(modelToSwitch);\n                    }\n                    var lastSettings = angular.copy($scope.joinNode.get('settings'));\n                    var currentSettings = angular.copy($scope.joinSettings);\n                    var node = $scope.joinNode;\n                    $scope.joinNode.set('settings', $scope.joinSettings);\n                    $scope.api.onChange();\n                    pushEditJoinSettingsEvent(node, lastSettings, currentSettings);\n                    addJoinSettings(currentSettings, $scope.joinNode, $scope.joinNodeBox);\n                    $scope.joinSettingsModal.dismiss();\n                };\n                function addJoinSettings(settings, model, view){\n                    var bottomContainer = view.find('.bottom-container');\n                    bottomContainer.find('.join').remove();\n                    _.each($scope.joinTypes, function(join){\n                        if(join.value == settings.type) {\n                            var type = bottomContainer.find('#type')[0];\n                            type.textContent = join.name;\n                            $(type).on('click', function(e){\n                                e.stopPropagation();\n                                configureNode({model: model, $box: view});\n                            })\n                        }\n                    });\n                    _.each(settings.conditions, function(item, index){\n                        var add = '<span class=\"join\"><span class=\"add-wrap\">';\n                        add += index == 0? 'On ' : 'And ';\n                        add += '<a class=\"lnk\">' + item.leftKey + ' = ' + item.rightKey + '</a></span></span>';\n                        bottomContainer.append(add);\n                    });\n                    bottomContainer.find('.join').on('click', function (e) {\n                        e.stopPropagation();\n                        configureNode({model: model, $box: view});\n                    });\n                }\n\n                var items, lastIcon;\n                var pointer = $elm.find('.arrow');\n                var previewWrapper = $elm.find('.data-preview-wrapper');\n                $elm.find('.toolbar-icon').draggable({\n                    helper: 'clone',\n                    cancel: false\n                });\n                function dropNode(event, ui){\n                    var o = $(ui.draggable[0]);\n                    var position = {\n                        x: event.pageX - $(event.target).offset().left - 37,\n                        y: event.pageY - $(event.target).offset().top - 37\n                    };\n                    switch (o.attr('id')){\n                        case 'join-button':\n                            return $scope.api.nodes.addJoin(position, true);\n                        default:\n                            var uid = o.find('input.uid').val();\n                            var u = $scope.getUploadById(uid);\n                            return $scope.api.nodes.addSources([u], position, true);\n                    }\n                }\n                $elm.find(\"#worksheet\").droppable({\n                    accept: \".upload-item,.toolbar-icon\",\n                    //activeClass: \"active\",\n                    hoverClass: \"drop-active\",\n                    over: function(event, ui){\n                        lastIcon = ui.helper.html();\n                        ui.helper.empty();\n                        // start dragging right after dropping a node to a canvas\n                        dropNode(event, ui).then(function(result){\n                            items = _.isArray(result) ? result : [result];\n                            _.each(items, function(item){\n                                var type = item.get('type');\n                                if(type != 'html.Link'\n                                    && type != 'html.LinkSample') {\n                                    item.findView(paper).$el.find('rect').mousedown();\n                                }\n                            })\n                        });\n                    },\n                    out: function(event, ui){\n                        if(items && lastIcon){\n                            ui.helper.html(lastIcon);\n                            _.each(items, function(item){\n                                item.remove();\n                            });\n                            items = undefined;\n                        }\n                    },\n                    drop: function(){\n                        pushAddNodeEvent(items);\n                        items = undefined;\n                        $scope.api.onChange();\n                    }\n                });\n\n                joint.shapes.html = {};\n                joint.shapes.html.Element = joint.shapes.basic.Generic.extend(_.extend({}, joint.shapes.basic.PortsModelInterface, {\n                    markup: '<g class=\"rotatable\"><g class=\"scalable\"><rect/></g><g class=\"inPorts\"/><g class=\"outPorts\"/></g>',\n                    inPortMarkup: '<g class=\"port<%= id %>\"><circle/></g>',\n                    outPortMarkup: '<g class=\"port<%= id %>\"><circle/></g>',\n                    defaults: joint.util.deepSupplement({\n                        type: 'html.Element',\n                        size: { width: 100, height: 80 },\n                        inPorts: [],\n                        outPorts: [],\n                        attrs: {\n                            '.': { magnet: false },\n                            rect: {\n                                stroke: 'none', 'fill-opacity': 0, width: 150, height: 250,\n                            },\n                            circle: {\n                                r: 8, //circle radius\n                                magnet: true,\n                                fill: 'transparent',\n                                stroke: 'transparent'\n                            },\n\n                            '.inPorts circle': { magnet: 'passive', type: 'input'},\n                            '.outPorts circle': { type: 'output'}\n                        }\n                    }, joint.shapes.basic.Generic.prototype.defaults),\n\n                    getPortAttrs: function (portName, index, total, selector, type) {\n                        var attrs = {};\n                        var portClass = 'port' + index;\n                        var portSelector = selector + '>.' + portClass;\n                        var portCircleSelector = portSelector + '>circle';\n                        attrs[portCircleSelector] = { port: { id: portName || _.uniqueId(type), type: type } };\n                        attrs[portSelector] = { ref: 'rect', 'ref-y': (index + 0.5) * (1 / total) };\n                        if (selector === '.outPorts') { attrs[portSelector]['ref-dx'] = 0; }\n                        return attrs;\n                    }\n                }));\n\n                joint.shapes.html.Link = joint.dia.Link.extend({\n                    defaults: {\n                        type: 'html.Link',\n                        attrs: { '.connection': { 'stroke-width': 1, stroke: '#BBB' } },\n                        router: {\n                            'name': 'manhattan',\n                            'args': {\n                                startDirections: ['left', 'right'],\n                                endDirections: ['left', 'right']\n                            }\n                        },\n                        connector: { name: 'rounded', args: { radius: 10 }}\n                        //smooth: true\n                    },\n                    markup: [\n                        '<path class=\"connection\"/>',\n                        '<path class=\"connection-wrap\"/>',\n                        '<g class=\"labels\"/>',\n                        '<g class=\"link-tools\" opacity=\"0\"/>'\n                    ].join(''),\n                    toolMarkup: [\n                        '<g class=\"link-tool\">',\n                        '<g class=\"tool-remove\" event=\"remove\">',\n                        '<circle id=\"outer\" r=\"11\" fill=\"white\"/>',\n                        '<circle id=\"inner\" r=\"9\" fill=\"white\"/>',\n                        '<line id=\"line\" x1=\"-5\" x2=\"5\" y1=\"0\" y2=\"0\" stroke=\"white\" stroke-width=\"2\" stroke-linecap=\"round\"/>',\n                        '<title>Remove link.</title>',\n                        '</g>',\n                        '</g>'\n                    ].join('')\n                });\n                joint.shapes.html.LinkSample = joint.dia.Link.extend({\n                    defaults: {\n                        type: 'html.LinkSample',\n                        attrs: { '.connection': { 'stroke-width': 1, stroke: '#CCC', 'stroke-dasharray': '3, 2' } },\n                        router: {\n                            'name': 'manhattan',\n                            'args': {\n                                startDirections: ['left', 'right'],\n                                endDirections: ['left', 'right']\n                            }\n                        },\n                        connector: { name: 'rounded', args: { radius: 10 }}\n                    }\n                });\n\n                joint.shapes.html.InputNode = joint.shapes.html.Element.extend({\n                    defaults: joint.util.deepSupplement({\n                        type: 'html.InputNode'\n                    }, joint.shapes.html.Element.prototype.defaults)\n                });\n                joint.shapes.html.UnionFolderNode = joint.shapes.html.Element.extend({\n                    defaults: joint.util.deepSupplement({\n                        type: 'html.UnionFolderNode'\n                    }, joint.shapes.html.Element.prototype.defaults)\n                });\n                joint.shapes.html.OutputNode = joint.shapes.html.Element.extend({\n                    defaults: joint.util.deepSupplement({\n                        type: 'html.OutputNode'\n                    }, joint.shapes.html.Element.prototype.defaults)\n                });\n                joint.shapes.html.JoinNode = joint.shapes.html.Element.extend({\n                    defaults: joint.util.deepSupplement({\n                        type: 'html.JoinNode'\n                    }, joint.shapes.html.Element.prototype.defaults)\n                });\n                joint.shapes.html.UnionNode = joint.shapes.html.Element.extend({\n                    defaults: joint.util.deepSupplement({\n                        type: 'html.UnionNode'\n                    }, joint.shapes.html.Element.prototype.defaults)\n                });\n\n                $scope.switchNodeType = function(model){\n                    var position = model.attributes.position;\n                    var type = model.attributes.type;\n                    model.remove();\n                    var factoryFn;\n                    if(type == \"html.JoinNode\") {\n                        factoryFn = $scope.api.nodes.addUnion;\n                    } else if(type == \"html.UnionNode\") {\n                        factoryFn = $scope.api.nodes.addJoin;\n                    }\n                    if(factoryFn){\n                        factoryFn(position, true).then(function(item){\n                            $scope.api.onChange();\n                            HistoryService.push({\n                                redo: function(){\n                                    model.remove();\n                                    addToGraph(item);\n                                    $scope.api.onChange();\n                                },\n                                undo: function(){\n                                    item.remove();\n                                    addToGraph(model);\n                                    $scope.api.onChange();\n                                }\n                            });\n                        })\n                    }\n                };\n\n                joint.shapes.html.LinkView = joint.dia.LinkView.extend({\n                    updateToolsPosition: function () {\n\n                        if (!this._V.labels) return this;\n\n                        var scale = '';\n                        var offset = this.getConnectionLength()/2;\n                        var connectionLength = this.getConnectionLength();\n\n                        if (!_.isNaN(connectionLength)) {\n\n                            if (connectionLength < this.options.shortLinkLength) {\n                                scale = 'scale(.5)';\n                            }\n\n                            var toolPosition = this.getPointAtLength(offset);\n\n                            this._toolCache.attr('transform', 'translate(' + toolPosition.x + ', ' + toolPosition.y + ') ' + scale);\n\n                            if (this.options.doubleLinkTools && connectionLength >= this.options.longLinkLength) {\n\n                                var doubleLinkToolsOffset = this.options.doubleLinkToolsOffset || offset;\n\n                                toolPosition = this.getPointAtLength(connectionLength - doubleLinkToolsOffset);\n                                this._tool2Cache.attr('transform', 'translate(' + toolPosition.x + ', ' + toolPosition.y + ') ' + scale);\n                                this._tool2Cache.attr('visibility', 'visible');\n\n                            } else if (this.options.doubleLinkTools) {\n\n                                this._tool2Cache.attr('visibility', 'hidden');\n                            }\n                        }\n\n                        return this;\n                    }\n                });\n                joint.shapes.html.LinkSampleView = joint.dia.LinkView.extend({});\n                joint.shapes.html.ElementView = joint.dia.ElementView.extend({\n\n                    initialize: function() {\n                        _.bindAll(this, 'updateBox');\n                        //this.listenTo(this.model, 'process:ports', this.update);\n                        joint.dia.ElementView.prototype.initialize.apply(this, arguments);\n\n                        this.$box = $(_.template(arguments[1])());\n                        this.$box.append(\n                            '<div class=\"progress-container\">' +\n                            '<div class=\"percent\"></div>' +\n                            '<div class=\"progress\" style=\"margin-bottom: 0;\">' +\n                            '<div class=\"progress-bar\" role=\"progressbar\" style=\"width: 0\"></div>' +\n                            '</div>' +\n                            '</div>');\n                        var model = this.model;\n                        if(model.get('type') != 'html.OutputNode') {\n                            var template = $templateCache.get(common.getFullTemplateName('worksheet/ops-node'));\n                            this.$box.append(template);\n                        }\n                        this.$box.find('.switch').on('click', function(){\n                            $scope.switchNodeType(model);\n                        });\n                        this.$box.find('.delete').on('click', _.bind(function(){\n                            if($scope.selectedNode && model.cid == $scope.selectedNode.model.cid)\n                                removeHighlight();\n                            model.remove.call(model);\n                            pushDeleteNodeEvent(model)\n                        }));\n                        // Update the box position whenever the underlying model changes.\n                        this.model.on('change', this.updateBox, this);\n                        // Remove the box when the model gets removed from the graph.\n                        this.model.on('remove', this.removeBox, this);\n\n                        this.updateBox();\n\n                        var settings = this.model.get('settings');\n                        if(settings.uploadId) {\n                            var u = indexUploads[settings.uploadId];\n                            if(u.descriptor && _.contains(['CSV', 'XLS_SHEET', 'XLSX_SHEET'], u.descriptor.format)){\n                                var startOnRowLabel = this.$box.find('.start-on-row');\n                                var refreshStartOnRowLabel = function(row){\n                                    startOnRowLabel.find('.lnk').text('Row ' + row);\n                                };\n                                if(startOnRowLabel.length > 0){\n                                    var rowSpan = this.$box.find('.row-text');\n                                    startOnRowLabel.show();\n                                    rowSpan.show();\n                                    refreshStartOnRowLabel(u.descriptor.settings.startOnRow);\n                                    startOnRowLabel.find('.lnk')\n                                        .on('click', function(){\n                                            $scope.$apply(function(){\n                                                if(u.descriptor.format == 'CSV'){\n                                                    $scope.editCsvSettings(u, function(upload){\n                                                        u.descriptor = upload.descriptor;\n                                                        refreshStartOnRowLabel(upload.descriptor.settings.startOnRow);\n                                                    });\n                                                } else {\n                                                    $scope.editXlsSettings(u, function(upload){\n                                                        u.descriptor = upload.descriptor;\n                                                        refreshStartOnRowLabel(upload.descriptor.settings.startOnRow);\n                                                    });\n                                                }\n                                            });\n                                        });\n                                }\n                                var useHeadersLabel = this.$box.find('.use-headers');\n                                var refreshUseHeadersLabel = function(useHeaders){\n                                    if(useHeaders){\n                                        useHeadersLabel.find('.lnk').text('Use Headers');\n                                    } else {\n                                        useHeadersLabel.find('.lnk').text('Skip Headers')\n                                    }\n                                };\n                                if(useHeadersLabel.length > 0) {\n                                    useHeadersLabel.show();\n                                    refreshUseHeadersLabel(u.descriptor.settings.useHeaders);\n                                    useHeadersLabel.find('.lnk')\n                                        .on('click', function () {\n                                            $scope.$apply(function(){\n                                                if(u.descriptor.format == 'CSV'){\n                                                    $scope.editCsvSettings(u, function(upload){\n                                                        u.descriptor = upload.descriptor;\n                                                        refreshUseHeadersLabel(upload.descriptor.settings.useHeaders);\n                                                    });\n                                                } else {\n                                                    $scope.editXlsSettings(u, function(upload){\n                                                        u.descriptor = upload.descriptor;\n                                                        refreshUseHeadersLabel(upload.descriptor.settings.useHeaders);\n                                                    });\n                                                }\n                                            })\n                                        });\n                                }\n                            }\n                        }\n                    },\n                    render: function() {\n                        joint.dia.ElementView.prototype.render.apply(this, arguments);\n                        this.paper.$el.prepend(this.$box);\n                        this.updateBox();\n                        return this;\n                    },\n                    update: function(){\n                        this.renderPorts();\n                        joint.dia.ElementView.prototype.update.apply(this, arguments);\n                    },\n                    updateBox: function() {\n                        // Set the position and dimension of the box so that it covers the JointJS element.\n                        var bbox = this.model.getBBox();\n                        // Example of updating the HTML with a data stored in the cell model.\n                        this.$box.find('.lbl').text(this.model.get('view').label);\n                        this.$box.css({ width: bbox.width, height: bbox.height, left: bbox.x, top: bbox.y, transform: 'rotate(' + (this.model.get('angle') || 0) + 'deg)', 'z-index': 100 + this.model.get('z')});\n                    },\n                    removeBox: function(evt) {\n                        this.$box.remove();\n                    },\n                    renderPorts: function() {\n                        var $inPorts = this.$('.inPorts').empty();\n                        var $outPorts = this.$('.outPorts').empty();\n\n                        var outPortTemplate = _.template(this.model.outPortMarkup);\n                        var inPortTemplate = _.template(this.model.inPortMarkup);\n\n                        _.each(_.filter(this.model.ports, function(p) { return p.type === 'in'; }), function(port, index) {\n                            $inPorts.append(joint.V(inPortTemplate({ id: index, port: port })).node);\n                        });\n                        _.each(_.filter(this.model.ports, function(p) { return p.type === 'out'; }), function(port, index) {\n                            $outPorts.append(joint.V(outPortTemplate({ id: index, port: port })).node);\n                        });\n                    }\n                });\n\n                joint.shapes.html.InputNodeView = joint.shapes.html.ElementView.extend({\n                    initialize: function() {\n                        var template = $templateCache.get(common.getFullTemplateName('worksheet/input-node'));\n                        var args = Array.prototype.slice.call(arguments);\n                        joint.shapes.html.ElementView.prototype.initialize.apply(this, args.concat([template]));\n                    }\n                });\n                joint.shapes.html.UnionFolderNodeView = joint.shapes.html.ElementView.extend({\n                    initialize: function() {\n                        var template = $templateCache.get(common.getFullTemplateName('worksheet/union-folder-node'));\n                        var args = Array.prototype.slice.call(arguments);\n                        joint.shapes.html.ElementView.prototype.initialize.apply(this, args.concat([template]));\n                    }\n                });\n                joint.shapes.html.OutputNodeView = joint.shapes.html.ElementView.extend({\n                    initialize: function() {\n                        var template = $templateCache.get(common.getFullTemplateName('worksheet/output-node'));\n                        var args = Array.prototype.slice.call(arguments);\n                        joint.shapes.html.ElementView.prototype.initialize.apply(this, args.concat([template]));\n                    }\n                });\n                joint.shapes.html.JoinNodeView = joint.shapes.html.ElementView.extend({\n                    initialize: function() {\n                        var template = $templateCache.get(common.getFullTemplateName('worksheet/join-node'));\n                        var args = Array.prototype.slice.call(arguments);\n                        joint.shapes.html.ElementView.prototype.initialize.apply(this, args.concat([template]));\n\n                        var that = this;\n                        this.$box.find('.bottom-container').on('click', function (e) {\n                            e.stopPropagation();\n                            configureNode({model: that.model, $box: that.$box});\n                        })\n                    }\n                });\n                joint.shapes.html.UnionNodeView = joint.shapes.html.ElementView.extend({\n                    initialize: function() {\n                        var template = $templateCache.get(common.getFullTemplateName('worksheet/union-node'));\n                        var args = Array.prototype.slice.call(arguments);\n                        joint.shapes.html.ElementView.prototype.initialize.apply(this, args.concat([template]));\n                    }\n                });\n                joint.dia.Worksheet = joint.dia.Paper.extend({\n                    pointermove: function(evt) {\n                        evt.preventDefault();\n                        evt = joint.util.normalizeEvent(evt);\n                        var localPoint = this.snapToGrid({ x: evt.clientX, y: evt.clientY });\n                        if (this.sourceView) {\n\n                            // Mouse moved counter.\n                            this._mousemoved++;\n                            this.sourceView.pointermove(evt, localPoint.x, localPoint.y);\n                        }\n                        this.trigger('pointermove', evt, localPoint.x, localPoint.y);\n                    }\n                });\n\n                graph = new joint.dia.Graph;\n                paper = new joint.dia.Worksheet({\n                    el: $elm.find('#worksheet'),\n                    gridSize: 10,\n                    model: graph,\n                    linkPinning: false,\n                    snapLinks: {radius: 30},\n                    interactive: function(cellView) {\n                        if (cellView.model instanceof joint.dia.Link) {\n                            // Disable the default vertex add functionality on pointerdown.\n                            return { vertexAdd: false };\n                        }\n                        return true;\n                    },\n                    defaultLink: new joint.shapes.html.Link,\n                    validateConnection: function(cellViewS, magnetS, cellViewT, magnetT, end, linkView) {\n\n                        var links = graph.getLinks();\n                        if(!_.contains(cellViewT.el.classList, 'UnionNode')){\n                            for (var i = 0; i < links.length; i++)\n                            {\n                                if(linkView == links[i].findView(paper)) //Skip the wire the user is drawing\n                                    continue;\n                                if ( (( cellViewT.model.id  == links[i].get('source').id ) && ( magnetT.getAttribute('port') == links[i].get('source').port)) ||\n                                    (( cellViewT.model.id  == links[i].get('target').id ) && ( magnetT.getAttribute('port') == links[i].get('target').port)) ){\n                                    return false;\n                                }\n                            }\n                        }\n                        // Prevent linking from input ports.\n                        if (magnetS && magnetS.getAttribute('type') === 'input') return false;\n                        // Prevent linking from output ports to input ports within one element.\n                        if (cellViewS === cellViewT) return false;\n                        // Prevent linking to input ports.\n                        return magnetT && magnetT.getAttribute('type') === 'input';\n                    },\n                    validateMagnet: function(cellView, magnet) {\n                        var links = graph.getLinks();\n                        // From a single port only one link can be spawned.\n                        for (var i = 0; i < links.length; i++){\n                            if( (( cellView.model.id  == links[i].get('source').id ) && ( magnet.getAttribute('port') == links[i].get('source').port) )||\n                                (( cellView.model.id  == links[i].get('target').id ) && ( magnet.getAttribute('port') == links[i].get('target').port) ))\n                                return false;\n                        }\n                        // Note that this is the default behaviour. Just showing it here for reference.\n                        // Disable linking interaction for magnets marked as passive (see below `.inPorts circle`).\n                        return magnet.getAttribute('magnet') !== 'passive';\n                    }\n\n                });\n\n                $scope.api.resize();\n\n                paper.on('blank:contextmenu', function(evt){\n                    evt.preventDefault();\n                });\n\n                paper.on('cell:contextmenu', function(cellView, evt){\n                    evt.preventDefault();\n                    if(!cellView.model.isLink()) {\n                        if(cellView.model.get('type') == 'html.InputNode'){\n                            $scope.$apply(function () {\n                                var options = $scope.inputNodeOptions();\n                                event.targetNode = cellView;\n                                common.renderContextMenu($scope, event, options);\n                            });\n                        }\n                    }\n                });\n\n                function removeHighlight(){\n                    $scope.columnsListMenu.isOpen = false;\n                    $scope.transformHistory = undefined;\n                    $scope.previewSettings = undefined;\n                    $scope.previewGridOptions = {\n                        enableColumnResize: true,\n                        columnDefs: [],\n                        data: []\n                    };\n                    pointer.hide();\n                    _.each(graph.getElements(), function(e){\n                        var view = paper.findViewByModel(e);\n                        view.$box.removeClass('hltd');\n                    });\n                }\n                function addHighlight(cellView){\n                    var bbox = cellView.model.getBBox();\n                    var color = cellView.$box.css('background-color');\n                    cellView.$box.addClass('hltd');\n                    var heightWithBottomContainer = cellView.$box.height() + cellView.$box.find('.bottom-container').height() + 15;\n                    pointer.css('left', (bbox.x + bbox.width / 2) + 'px');\n                    pointer.css('top', (bbox.y + heightWithBottomContainer) + 'px');\n                    pointer.show();\n                    pointer.find('.head .inner').css('border-color', 'transparent transparent ' + color + ' transparent');\n                    pointer.find('.body').css('background-color', color);\n                    previewWrapper.css('background-color', color);\n                }\n\n                //paper.on('blank:pointerclick', function(evt, x, y){\n                //    removeHighlight();\n                //    $scope.selectedNode = undefined;\n                //    actualSelectedNode = undefined;\n                //    refreshPreview({data: []});\n                //});\n\n                paper.on('cell:pointerclick', function(cellView, evt, x, y){\n                    if (!cellView.model.isLink()) {\n                        var sourceView;\n                        if (cellView.model.get('type') == 'html.OutputNode') {\n                            var link = graph.getConnectedLinks(cellView.model, {inbound: true})[0];\n                            if(link)\n                                sourceView = paper.findViewByModel(graph.getCell(link.get('source').id));\n                        }\n                        var oldNode = $scope.selectedNode;\n                        $scope.selectedNode = (sourceView || cellView);\n                        var updatePreview = actualSelectedNode == null || cellView.model.id != actualSelectedNode.model.id;\n                        actualSelectedNode = cellView;\n                        cellView.model.toFront();\n                        if(updatePreview) {\n\n                            removeHighlight();\n                            addHighlight(cellView);\n                            if($scope.selectedNode.model.get('type') != 'html.OutputNode') {\n                                $scope.transformHistory = $scope.selectedNode.model.get('settings').transforms;\n                                fillOpsTransformList($scope.selectedNode.$box, $scope.transformHistory);\n                            }\n                            $scope.api.preview();\n                            pushSelectNode(oldNode, $scope.selectedNode);\n                        }\n                    }\n                });\n\n                var lastPosition;\n                paper.on('cell:pointerdown', function(cellView, evt, x, y){\n                    if(!cellView.model.isLink()) {\n                        lastPosition = cellView.model.position();\n                    } else {\n                        var targetParentEvent = evt.target.parentNode.getAttribute('event');\n                        if (targetParentEvent) {\n                            if (targetParentEvent === 'remove') {\n                                pushDeleteLinkEvent(cellView.model);\n                            }\n                        }\n                    }\n                });\n                paper.on('cell:pointerup', function(cellView, evt, x, y){\n                    if(!cellView.model.isLink()) {\n                        var lastCellPosition = lastPosition,\n                            currentCellPosition = cellView.model.position();\n                        if (lastCellPosition.x != currentCellPosition.x\n                            || lastCellPosition.y != currentCellPosition.y) {\n                            if(!items) {\n                                pushMoveNodeEvent(cellView, lastCellPosition, currentCellPosition);\n                            }\n                        }\n                        _.each(graph.getLinks(), function(link){\n                            if(link.get('type') == 'html.LinkSample'){\n                                link.remove();\n                                var newLink = new joint.shapes.html.Link({\n                                    source: link.get('source'),\n                                    target: link.get('target')\n                                });\n                                graph.addCell(newLink);\n                                var model = graph.getCell(newLink.get('target').id);\n                                if(model.get('type') == 'html.JoinNode')\n                                    getJoinNodeInPorts(model, evt);\n                                $scope.api.onChange();\n                            }\n                        })\n                    }\n                    else if(cellView.targetView && cellView.targetView.model.get('type') == 'html.JoinNode'){\n                        getJoinNodeInPorts(cellView.targetView.model, evt);\n                    }\n                });\n                paper.on('cell:mouseover', function(cellView, evt){\n                    if (!cellView.model.isLink()) {\n                        cellView.$box.find('a.delete')\n                            .css('color', '#CBCBCB')\n                            .hover(function () {\n                                $(this).css('color', '#CBCBCB').css('text-decoration', 'underline')\n                            }, function () {\n                                $(this).css('color', '#CBCBCB').css('text-decoration', 'none')\n\n                            });\n                    }\n                });\n                paper.on('cell:mouseout', function(cellView, evt){\n                    if (!cellView.model.isLink()) {\n                        cellView.$box.find('a.delete').css('color', 'transparent');\n                    }\n                });\n                paper.off('cell:highlight');\n                paper.off('cell:unhighlight');\n                paper.on('cell:highlight', function(cellView, evt){\n                    var portNumber = $(evt).attr('port');\n                    if(portNumber == 'in1')\n                    {\n                        if(cellView.$box.find('.in-port-1').length)\n                            cellView.$box.find('.in-port-1').addClass('highlight');\n                        else\n                            cellView.$box.find('.in-port').addClass('highlight');\n                    }\n                    else if(portNumber == 'in2')\n                    {\n                        cellView.$box.find('.in-port-2').addClass('highlight');\n                    }\n                });\n                paper.on('cell:unhighlight', function(cellView, evt){\n                    cellView.$box.find('.highlight').removeClass('highlight');\n                });\n\n                function getJoinNodeInPorts(model, e){\n                    var links = graph.getConnectedLinks(model, {inbound: true});\n                    if(links.length == 2 && _.all(links, function(link){ return link.get('type') == 'html.Link' } )) {\n                        e.stopPropagation();\n                        configureNode({model: model, $box: model.findView(paper).$box});\n                    }\n                }\n                function getFreePorts(cell, opts){\n                    var view = cell.findView(paper);\n                    if(!view) return [];\n                    var nonAvailablePorts = _(graph.getConnectedLinks(cell, opts))\n                        .map(function(link){\n                            var unlimitedInPort = false;\n                            if(cell.get('type') == 'html.UnionNode'){\n                                unlimitedInPort = true;\n                            }\n                            if(opts.outbound && (!unlimitedInPort && opts.inbound)) {\n                                return [link.get('source').port, link.get('target').port];\n                            } else if (opts.outbound){\n                                return link.get('source').port;\n                            } else if (!unlimitedInPort && opts.inbound) {\n                                return link.get('target').port;\n                            }\n                        }).flatten().value();\n\n                    return _(cell.ports).filter(function(port){\n                        return ((opts.inbound && port.type === 'in') || (opts.outbound && port.type == 'out'))\n                            && !_.contains(nonAvailablePorts, port.id);\n                    }).map(function(port, idx){\n                        var baseClass = port.type + 'Ports', className = 'port' + idx;\n                        return {cell: cell, port: port, portView: view.$('.' + baseClass + '>.' + className)[0]}\n                    }).value();\n                }\n\n                function tryCreateSampleLink(outPorts, inPorts){\n                    var connected = false;\n                    _.each(outPorts, function(outPort){\n                        var bbox = joint.util.getElementBBox(outPort.portView);\n                        var currentPortRect = joint.g.rect(bbox.x, bbox.y, bbox.width, bbox.height);\n                        var currentPortCenter = currentPortRect.center();\n\n                        _.each(inPorts, function(inPort){\n                            bbox = joint.util.getElementBBox(inPort.portView);\n                            var availablePortRect = joint.g.rect(bbox.x, bbox.y, bbox.width, bbox.height);\n                            var availablePortCenter = availablePortRect.center();\n                            var distance = currentPortCenter.distance(availablePortCenter);\n                            if (distance < linkSampleThreshold) {\n                                graph.addCell(new joint.shapes.html.LinkSample({\n                                    source: {\n                                        id: outPort.cell.id,\n                                        port: outPort.port.id\n                                    },\n                                    target: {\n                                        id: inPort.cell.id,\n                                        port: inPort.port.id\n                                    }\n                                }));\n                                connected = true;\n                                return false;\n                            }\n                        });\n                        if(connected){\n                            return false;\n                        }\n                    });\n                }\n\n                var linkSampleThreshold = 140;\n                paper.on('pointermove', function(evt, x, y){\n                    if(items){\n                        _.each(items, function(item){\n                            var type = item.get('type');\n\n                            if(type != 'html.Link'\n                                && type != 'html.LinkSample') {\n                                if(type == 'html.OutputNode'){\n                                    item.position(x - 40 + outputNodeOffsetX, y - 40);\n                                } else {\n                                    item.position(x - 40, y - 40);\n                                }\n                            }\n                        })\n                    }\n                });\n                paper.on('cell:pointermove', function(cellView) {\n\n                    // remove link to farther elements\n                    var links = graph.getConnectedLinks(cellView.model);\n                    _.forEach(links, function(link){\n                        if(link.get('type') == 'html.LinkSample') {\n                            var distance = paper.findViewByModel(link).getConnectionLength();\n                            if (distance > linkSampleThreshold + 10) {\n                                link.remove();\n                            }\n                        }\n                    });\n                    if(actualSelectedNode && actualSelectedNode.model.id == cellView.model.id){\n                        addHighlight(cellView);\n                    }\n\n                    // create links to nearest elements from output port\n                    var currentOutPorts = getFreePorts(cellView.model, {outbound: true});\n                    var availableInPorts = _(graph.getElements())\n                        .filter(function(cell){ return cell.id != cellView.model.id})\n                        .map(function(cell){\n                            return getFreePorts(cell, {inbound: true});\n                        }).flatten().value();\n                    tryCreateSampleLink(currentOutPorts, availableInPorts);\n\n                    // create links from nearest elements to input port\n                    var currentInPorts = getFreePorts(cellView.model, {inbound: true});\n                    var availableOutPorts = _(graph.getElements())\n                        .filter(function(cell){ return cell.id != cellView.model.id})\n                        .map(function(cell) {\n                            return getFreePorts(cell, {outbound: true});\n                        }).flatten().value();\n                    tryCreateSampleLink(availableOutPorts, currentInPorts);\n                });\n\n                graph.on('change:source change:target', function(link) {\n                    if(link.get('type') != 'html.LinkSample') {\n                        if (link.get('source').id && link.get('target').id) {\n                            $scope.api.onChange();\n                        }\n                    }\n                });\n                graph.on('remove', function(cell){\n                    if (!cell.isLink()) {\n                        if($scope.selectedNode && cell.id == $scope.selectedNode.model.id) {\n                            $scope.selectedNode = undefined;\n                            actualSelectedNode = undefined;\n                        }\n                        var elements = graph.getElements();\n                        if(elements.length == 1 && elements[0].get('type') == 'html.OutputNode'){\n                            var out = elements[0];\n                            if($scope.selectedNode)\n                                removeHighlight();\n                            out.remove();\n                        }\n                    }\n                    $scope.api.onChange();\n                });\n\n                function configureNode(cellView) {\n                    if(!cellView.model.isLink()){\n                        var e = cellView.model;\n                        if(e.get('type') == 'html.JoinNode') {\n\n                            $scope.joinNode = e;\n                            $scope.joinNodeBox = cellView.$box;\n                            $scope.joinSettings = angular.copy(e.get('settings'));\n\n                            var links = graph.getConnectedLinks(e, {inbound: true});\n                            var leftL, rightL;\n                            if (links[0] && links[0].get('target')) {\n                                if (links[0].get('target').port == 'in1') {\n                                    leftL = links[0];\n                                } else {\n                                    rightL = links[0];\n                                }\n                            }\n                            if(links[1] && links[1].get('target')){\n                                if(links[1].get('target').port == 'in0'){\n                                    leftL = links[1];\n                                } else {\n                                    rightL = links[1];\n                                }\n                            }\n\n                            if(leftL){\n                                $http.post('/api/flow/columns', {flowJSON: serializeGraph(), rootNode: leftL.get('source').id})\n                                    .success(function(data){\n                                        $scope.joinLeftDs = data;\n                                    })\n                                    .error(common.showError);\n                            }\n                            if(rightL){\n                                $http.post('/api/flow/columns', {flowJSON: serializeGraph(), rootNode: rightL.get('source').id})\n                                    .success(function(data){\n                                        $scope.joinRightDs = data;\n                                    })\n                                    .error(common.showError);\n                            }\n                            $scope.joinParam = {type: 'join'};\n                            $scope.joinType = 'JOIN';\n                            showJoinSettingsModal(e);\n                        }\n                        else if(e.get('type') == 'html.UnionNode'){\n                            $scope.joinParam = {type: 'union', text: 'Fields will be added together based on fields name.'};\n                            $scope.joinType = 'UNION';\n                            showJoinSettingsModal(e);\n                        }\n                    }\n                }\n\n                function fillOpsTransformList(node, transforms) {\n                    var nodeOps = node.find('.ops-node');\n                    nodeOps.find('div.add').remove();\n                    _.each(transforms, function (item, iter) {\n                        var transform;\n                        if (iter == 5) {\n                            transform = '<div class=\"add\"> + ' + (transforms.length - 5) + ' more ops</div>';\n                            nodeOps.find('.ops-bottom-container').append(transform);\n                        } else if (iter < 5) {\n                            transform = '<div class=\"add\">&bull; ' + item.title.toUpperCase() + ' for ' + $scope.getTransformColumnNames(item) + '</div>';\n                            nodeOps.find('.ops-bottom-container').append(transform);\n                        }\n                    });\n                    nodeOps.find('.ops-node-text')[0].textContent = transforms.length + ' Ops';\n                    if (nodeOps.is(':hidden') && transforms.length)\n                        nodeOps.show();\n                    else if(!transforms.length)\n                        nodeOps.hide();\n                }\n\n                $scope.transformHistory = [];\n                $scope.addTransform = function(item){\n                    if(!$scope.isIndexChanged)\n                        $scope.isIndexChanged = true;\n                    $scope.transformHistory.push(item);\n                    fillOpsTransformList($scope.selectedNode.$box, $scope.transformHistory);\n                    $scope.api.preview();\n\n                    var index = $scope.transformHistory.length - 1;\n                    pushAddTransform(item, index);\n                };\n\n                $scope.deleteTransform = function(i){\n                    var itemCopy = angular.copy($scope.transformHistory[i]);\n\n                    if(!$scope.isIndexChanged)\n                        $scope.isIndexChanged = true;\n                    $scope.transformHistory.splice(i, 1);\n                    fillOpsTransformList($scope.selectedNode.$box, $scope.transformHistory);\n                    $scope.api.preview();\n\n                    pushDeleteTransform(itemCopy, i);\n                };\n\n                $scope.updateColumnName = function(column){\n                    column.edited = false;\n                    var columnSettings = _.find($scope.selectedNode.model.get('settings').columns, {name: column.colDef.originalName});\n                    var oldColName = column.displayName;\n                    columnSettings.rename = column.rename;\n                    column.displayName = column.rename;\n                    $scope.api.preview();\n\n                    // todo: retreive column name instead of object\n                    pushUpdateColumnName(oldColName, column.displayName);\n                };\n\n                $scope.getCurrentSettingsByName = getCurrentSettingsByName;\n\n                $scope.keydownColumnName = function(column, event){\n                    if (event.which == 27) {\n                        column.rename = column.displayName;\n                        event.target.blur();\n                        event.preventDefault();\n                        event.stopPropagation();\n                    } else if(event.which == 13){\n                        column.edited = false;\n                        event.target.blur();\n                        event.preventDefault();\n                        event.stopPropagation();\n                    }\n                };\n\n                function getCurrentSettingsByName(originalName){\n                    return _.find($scope.selectedNode.model.get('settings').columns, function(column){ return column.name == originalName})\n                }\n\n                function rowTransform(item){\n                    return {\n                        title: item.title,\n                        icon: 'fa fa-fw',\n                        action: function(){\n                            var columnName = this.context.col.colDef.originalName;\n                            $scope.addTransform(_.merge(item, {columnName: columnName}));\n                        }\n                    };\n                }\n                function addSeparator(){\n                    return{\n                        isSeparator: true\n                    };\n                }\n                function renameColumn(){\n                    return {\n                        title: \"Rename\",\n                        icon: 'fa fa-fw',\n                        action: function(){\n                            var that = this;\n                            this.context.col.edited = this;\n                            this.context.col.rename = this.context.col.displayName;\n                            $timeout(function(){ $('.data-preview').find('#' + that.context.col.grid.id + '-' + that.context.col.uid + '-new-name')[0].focus() });\n                        }\n                    }\n                }\n                function convertToListColumn(selected) {\n                    return{\n                        title: \"Convert to list...\",\n                        icon: selected ? 'fa fa-fw fa-check' : 'fa fa-fw',\n                        action: function(){\n                            var settings = getCurrentSettingsByName(this.context.col.colDef.originalName);\n                            $scope.showConvertToListModal(settings);\n                        }\n                    }\n                }\n                function preserveHistoryColumn(selected) {\n                    function getIcon(selected) { return selected ? 'fa fa-fw fa-check' : 'fa fa-fw'; }\n                    var m = {\n                        title: \"Preserve History\",\n                        icon: getIcon(selected),\n                        action: function(){\n                            var settings = getCurrentSettingsByName(this.context.col.colDef.originalName);\n                            $scope.showPreserveHistoryModal(settings, m);\n                        }\n                    };\n                    return m;\n                }\n                function annotateColumn(){\n                    return{\n                        title: \"Annotate\",\n                        icon: 'fa fa-fw',\n                        action: function(){\n                            var settings = getCurrentSettingsByName(this.context.col.colDef.originalName);\n                            $scope.showAnnotationModal(settings);\n                        }\n                    }\n                }\n                function distinctColumn(columns){\n                    return{\n                        title: \"Deduplicate\",\n                        icon: 'fa fa-fw',\n                        action: function(){\n                            $scope.showDistinctModal(columns, this.context.col.colDef.originalName);\n                        }\n                    }\n                }\n                function facets(isEnabled){\n                    return{\n                        title: \"Disable facets\",\n                        icon: isEnabled? 'fa fa-fw fa-check' : 'fa fa-fw',\n                        action: function(){\n                            var settings = getCurrentSettingsByName(this.context.col.colDef.originalName);\n                            settings.disableFacets = !settings.disableFacets;\n                            pushDisableFacets(settings);\n                            $scope.api.preview();\n                        }\n                    }\n                }\n                function setAsPk(isPk){\n                    return {\n                        title: \"Set As Primary Key\",\n                        icon: isPk ? 'fa fa-fw fa-check' : 'fa fa-fw',\n                        action: function(){\n                            var settings = getCurrentSettingsByName(this.context.col.colDef.originalName);\n                            var previousPkeyColumn;\n\n                            if(!settings.pkey) {\n                                var columns = $scope.selectedNode.model.get('settings').columns;\n                                _.each(columns, function (column) {\n                                    if (column.pkey) {\n                                        previousPkeyColumn = column;\n                                    }\n                                    column.pkey = false\n                                });\n                            }\n                            settings.pkey = !settings.pkey;\n                            $scope.api.preview();\n\n                            pushSetAsPk(previousPkeyColumn, settings);\n                        }\n                    }\n                }\n                function formatCurrency(selected){\n                    return{\n                        title: \"Currency\",\n                        icon: selected ? 'fa fa-fw fa-check' : 'fa fa-fw',\n                        action: function(){\n                            var settings = getCurrentSettingsByName(this.context.col.colDef.originalName);\n                            $scope.showFormatModal(settings);\n                        }\n                    }\n                }\n                function coerceToFormat(title, format, selected){\n                    return{\n                        title: title,\n                        icon: selected ? 'fa fa-fw fa-check' : 'fa fa-fw',\n                        action: function() {\n                            var settings = getCurrentSettingsByName(this.context.col.colDef.originalName);\n                            $scope.setDataFormat(settings, format)\n                        }\n                    }\n                }\n                function deleteFormats(selected){\n                    return{\n                        title: \"Automatic\",\n                        icon: selected ? 'fa fa-fw fa-check' : 'fa fa-fw',\n                        action: function(){\n                            var settings = getCurrentSettingsByName(this.context.col.colDef.originalName);\n                            $scope.setDataFormat(settings)\n                        }\n                    }\n                }\n                function coerceToType(title, typeOrAction, selected){\n                    return {\n                        title: title,\n                        icon: selected ? 'fa fa-fw fa-check' : 'fa fa-fw',\n                        action: function(){\n                            var settings = getCurrentSettingsByName(this.context.col.colDef.originalName);\n                            settings.filter = null;\n                            settings.formatSymbol = null;\n                            settings.decimalPlaces = null;\n\n                            var oldTypeOrAction = angular.copy(settings.type);\n                            var newTypeOrAction = angular.copy(typeOrAction);\n\n                            if (typeof typeOrAction === \"function\") {\n                                typeOrAction(settings);\n                            } else {\n                                settings.type = typeOrAction;\n                                if(settings.type.dataType == 'STRING') {\n                                    settings.searchType = 'EDGE';\n                                } else {\n                                    settings.searchType = 'NONE'\n                                }\n                                $scope.api.preview();\n                                pushCoerceToType(this.context.col.colDef.originalName, oldTypeOrAction, newTypeOrAction, settings);\n                            }\n\n                        }\n                    }\n                }\n\n                function removeErrors(selected){\n                    return {\n                        title: 'Remove Errors',\n                        icon: selected ? 'fa fa-fw fa-check' : 'fa fa-fw',\n                        action: function(){\n                            var settings = getCurrentSettingsByName(this.context.col.colDef.originalName);\n                            settings.removeErrors = !settings.removeErrors;\n                            $scope.api.preview();\n\n                            pushRemoveErrors(settings.name);\n                        }\n                    }\n                }\n\n                function replaceErrors(selected){\n                    return {\n                        title: 'Replace Errors',\n                        icon: selected ? 'fa fa-fw fa-check' : 'fa fa-fw',\n                        action: function(){\n                            var settings = getCurrentSettingsByName(this.context.col.colDef.originalName);\n                            $scope.showReplaceErrorsModal(settings);\n                        }\n                    }\n                }\n\n                function searchType(title, type, selected) {\n                    return{\n                        title: title,\n                        icon: selected ? 'fa fa-fw fa-check' : 'fa fa-fw',\n                        action: function(){\n                            var settings = getCurrentSettingsByName(this.context.col.colDef.originalName);\n                            settings.searchType = type;\n                            refreshPreviewFromCache();\n                        }\n                    }\n                }\n\n                function getVisibility(originalName){\n                    var settings = getCurrentSettingsByName(originalName);\n                    return settings ? !settings.removed : true\n                }\n\n                $scope.getValueType = function(value){\n                    if(value == null || value == undefined){\n                        return 'null';\n                    } else if (value.type && value.type == 'ERROR'){\n                        return 'error';\n                    }\n                    return 'default';\n                };\n\n                $scope.isArray = function(value){\n                    return _.isArray(value)\n                };\n\n                $scope.wrapArray = function(value){\n                    return _.isArray(value) ? value : [value];\n                };\n\n                function getCellTemplate(field, settings){\n                    field = field\n                        // todo get rid of that\n                        .split('<').join('&lt;')\n                        .split('>').join('&gt;')\n                        .split('\\\\').join('\\\\\\\\');\n                    var basicTemplate = \"\";//common.uiGridBasicCellTemplate;\n                    var params = { field: field, before: null, after: null, filters: null };\n                    switch(settings.filter){\n                        case 'financial':\n                            params.filters = '| financialFilter';\n                            break;\n                        case 'currency':\n                            params.before = settings.formatSymbol;\n                            params.filters = '| number:' + (settings.decimalPlaces || 0);\n                            break;\n                        case 'number':\n                            params.filters = '| number:' + settings.decimalPlaces;\n                            break;\n                        case 'percent':\n                            params.after = '%';\n                            params.filters = '| number: 2';\n                            break;\n                        case 'date':\n                            params.filters = '| date: \"MM/dd/yyyy\"';\n                            break;\n                        case 'time':\n                            params.filters = '| date: \"h:mma\"';\n                            break;\n                        case 'datetime':\n                            params.filters = '| date: \"MM/dd/yyyy HH:mm:ss\"';\n                            break;\n                        case 'codes':\n                            params.filters = '| locationCodesFilter';\n                            break;\n                        case 'lat-lon':\n                            params.filters = '| locationLatLonFilter';\n                            break;\n                        case 'duration':\n                            params.filters = '| date: \"HH:mm:ss\"';\n                            break;\n                    }\n                    return basicTemplate(params);\n                }\n\n                var lastPreviewResponse, lastColumnDefs = [];\n                function preparePreviewData(response){\n                    if(response.descriptor && $scope.selectedNode){\n                        var editable = $scope.selectedNode.model.get('type') != 'html.OutputNode';\n                        var rowsCount = response.descriptor.rowsExactCount || response.descriptor.rowsEstimatedCount;\n                        $scope.previewSettings = {\n                            skippedCount: response.skippedCount,\n                            name: actualSelectedNode.model.get('view').label || actualSelectedNode.$box.find('.icon-text').text(),\n                            enableNestedView: _.contains(['JSON_ARRAY', 'JSON_OBJECT', 'XML'], response.descriptor.format),\n                            columns: response.descriptor.columns.length,\n                            removedColumns: _.countBy($scope.selectedNode.model.get('settings').columns, 'removed').true,\n                            rows: Math.min(rowsCount, 1000),\n                            editable: editable\n                        };\n                        $scope.currentQueryData.cachedPreviewData = response.cached;\n                        if(!$scope.currentView || ($scope.currentView == ViewType.NESTED && !$scope.previewSettings.enableNestedView)){\n                            $scope.currentView = ViewType.TABLE;\n                        }\n                        lastColumnDefs = [];\n                        lastPreviewResponse = response;\n                        var columnSettings = _.groupBy($scope.selectedNode.model.get('settings').columns, 'name');\n                        var descriptorColumns = _.sortBy(response.descriptor.columns, 'settings.index');\n                        _.each(descriptorColumns, function (column, index) {\n                            var originalName = column.name,\n                                displayName = column.settings.rename || column.settings.name || column.name,\n                                menuItems = [],\n                                formatSubItems = [];\n\n                            if(!columnSettings[column.name]){\n                                $scope.selectedNode.model.get('settings').columns.push(column.settings);\n                                column.settings.type = column.type;\n                                column.settings.name = originalName;\n                            } else {\n                                columnSettings[column.name] = column.settings;\n                                if(!column.settings.type){\n                                    column.settings.type = column.type;\n                                }\n                            }\n                            column.settings.index = index;\n\n                            if(!column.settings.searchType){\n                                if(column.settings.type.dataType == 'STRING') {\n                                    column.settings.searchType = 'EDGE';\n                                } else {\n                                    column.settings.searchType = 'NONE'\n                                }\n                            }\n\n                            switch(column.settings.type.dataType.toLowerCase()){\n                                case 'location_lat_lon':\n                                    column.settings.filter = 'lat-lon';\n                                    break;\n                                case 'location_usa_state_codes':\n                                case 'location_country_codes':\n                                    column.settings.filter = 'codes';\n                                    break;\n                            }\n\n                            switch(column.settings.type.dataType.toLowerCase()){\n                                case 'double':\n                                case 'integer':\n                                    formatSubItems.push(deleteFormats(!column.settings.filter));\n                                    formatSubItems.push(addSeparator());\n                                    formatSubItems.push(coerceToFormat('Number', 'number', column.settings.filter == 'number'));\n                                    formatSubItems.push(coerceToFormat('Percent', 'percent', column.settings.filter == 'percent'));\n                                    formatSubItems.push(addSeparator());\n                                    formatSubItems.push(formatCurrency(column.settings.filter == 'currency'));\n                                    formatSubItems.push(coerceToFormat('Financial', 'financial', column.settings.filter == 'financial'));\n                                    break;\n                                case 'date':\n                                    formatSubItems.push(deleteFormats(!column.settings.filter));\n                                    formatSubItems.push(addSeparator());\n                                    formatSubItems.push(coerceToFormat('Date', 'date', column.settings.filter == 'date'));\n                                    formatSubItems.push(coerceToFormat('Time', 'time', column.settings.filter == 'time'));\n                                    formatSubItems.push(coerceToFormat('Date time', 'datetime', column.settings.filter == 'datetime'));\n                                    formatSubItems.push(coerceToFormat('Duration', 'duration', column.settings.filter == 'duration'));\n                                    break;\n                            }\n\n                            menuItems.push({\n                                title: \"Data Type\",\n                                icon: 'fa fa-fw',\n                                subItems: [\n                                    coerceToType(\"String\", {'@class': 'com.dataparse.server.service.parser.type.TypeDescriptor', dataType: 'STRING'}, column.settings.type.dataType == 'STRING'),\n                                    coerceToType(\"Number (whole)\", {'@class': 'com.dataparse.server.service.parser.type.TypeDescriptor', dataType: 'INTEGER'}, column.settings.type.dataType == 'INTEGER'),\n                                    coerceToType(\"Number (decimal)\", {'@class': 'com.dataparse.server.service.parser.type.TypeDescriptor', dataType: 'DOUBLE'}, column.settings.type.dataType == 'DOUBLE'),\n                                    coerceToType(\"Date/Time\", {'@class': 'com.dataparse.server.service.parser.type.TypeDescriptor', dataType: 'DATE'}, column.settings.type.dataType == 'DATE'),\n                                    coerceToType(\"Boolean\", {'@class': 'com.dataparse.server.service.parser.type.TypeDescriptor', dataType: 'BOOLEAN'}, column.settings.type.dataType == 'BOOLEAN'),\n                                    {\n                                        title: \"Geographic\",\n                                        icon: 'fa fa-fw ' + (_.contains(['LOCATION_LAT_LON', 'LOCATION_USA_STATE_CODES', 'LOCATION_COUNTRY_CODES'], column.settings.type.dataType) ? 'fa-check' : ''),\n                                        subItems: [\n                                            coerceToType(\"Coordinates\", {'@class': 'com.dataparse.server.service.parser.type.TypeDescriptor', dataType: 'LOCATION_LAT_LON'}, column.settings.type.dataType == 'LOCATION_LAT_LON'),\n                                            coerceToType(\"Country Code\", {'@class': 'com.dataparse.server.service.parser.type.TypeDescriptor', dataType: 'LOCATION_COUNTRY_CODES'}, column.settings.type.dataType == 'LOCATION_COUNTRY_CODES'),\n                                            coerceToType(\"State Code\", {'@class': 'com.dataparse.server.service.parser.type.TypeDescriptor', dataType: 'LOCATION_USA_STATE_CODES'}, column.settings.type.dataType == 'LOCATION_USA_STATE_CODES')\n                                        ]\n                                    }\n                                ]\n                            });\n\n                            if(formatSubItems.length){\n                                menuItems.push({\n                                    title: \"Data Format\",\n                                    icon: 'fa fa-fw',\n                                    subItems: formatSubItems\n                                });\n                            }\n                            if(actualSelectedNode.model.get('type') == 'html.OutputNode') {\n                                menuItems.push({\n                                    title: \"Search Type\",\n                                    icon: 'fa fa-fw',\n                                    subItems: [\n                                        searchType(\"Do not search on column\", \"NONE\", column.settings.searchType == \"NONE\"),\n                                        searchType(\"Edge search\", \"EDGE\", column.settings.searchType == \"EDGE\"),\n                                        searchType(\"Full inner search\", \"FULL\", column.settings.searchType == \"FULL\")\n                                    ]\n                                });\n                                menuItems.push(facets(column.settings.disableFacets));\n                            }\n\n                            menuItems.push(addSeparator());\n                            if(column.settings.type.dataType == 'STRING'){\n                                menuItems = menuItems.concat([\n                                    rowTransform({title: 'Uppercase', '@class': '.column.UpperTransform'}),\n                                    rowTransform({title: 'Lowercase', '@class': '.column.LowerTransform'}),\n                                    rowTransform({title: 'CamelCase', '@class': '.column.CapitalCaseTransform'}),\n                                    rowTransform({title: 'Clean whitespace', '@class': '.column.CleanWhitespaceTransform'})\n                                ])\n                            }\n                            menuItems.push(distinctColumn(response.descriptor.columns));\n\n                            menuItems = menuItems.concat([\n                                convertToListColumn(column.settings.splitOn),\n                                addSeparator(),\n                                renameColumn(),\n                                annotateColumn(),\n                                {\n                                    title: 'Handle Error',\n                                    icon: 'fa fa-fw',\n                                    subItems: [\n                                        removeErrors(column.settings.removeErrors),\n                                        replaceErrors(column.settings.replaceErrors)\n                                    ]\n                                }\n                            ]);\n\n                            if(column.settings.pkey || column.pkey\n                                || _.contains(['STRING', 'INTEGER'], column.settings.type.dataType)){\n\n                                column.settings.preserveHistory = null;\n                                menuItems.push(setAsPk(column.settings.pkey))\n                            }\n\n                            if (!column.settings.pkey && !column.pkey && actualSelectedNode.model.get('type') == 'html.OutputNode') {\n                                menuItems.push(preserveHistoryColumn(!!column.settings.preserveHistory));\n                            }\n\n                            lastColumnDefs.push({\n                                name: 'fields[\\'' + displayName + '\\']',\n                                field: 'fields[\\'' + displayName + '\\']',\n                                visible: getVisibility(originalName),\n                                cellClass: (column.settings.type.dataType == 'STRING' ? 'left' : 'right'),\n                                originalName: originalName,\n                                displayName: common.unscreen(displayName),\n                                annotation: column.settings.annotation,\n                                filter: column.settings.filter,\n                                formatSymbol: column.settings.formatSymbol,\n                                decimalPlaces: column.settings.decimalPlaces,\n                                width: 'content',\n                                enableHiding: false,\n                                enableColumnMenu: $scope.previewSettings.editable,\n                                enableColumnMoving: $scope.previewSettings.editable,\n                                menuItems: menuItems,\n                                // headerCellTemplate: common.getColumnHeaderDef(column.settings.type.dataType, column.settings.pkey, true),\n                                cellTemplate: getCellTemplate(displayName, column.settings)\n                            });\n                        });\n                    }\n                    $scope.refreshCurrentView($scope.currentView);\n                }\n\n                function createTableView(response, columnDefs){\n                    var data = response.data,\n                        descriptor = response.descriptor;\n                    if (data.length == 0) {\n                        $scope.previewGridOptions.data.length = 0;\n                    }\n                    $scope.previewGridOptions.columnDefs = [];\n                    if(descriptor && $scope.selectedNode) {\n                        data = _.map(data, function(row){ return {fields: row}});\n                    }\n                    $timeout(function(){\n                        $scope.previewGridOptions = {\n                            enableColumnResize: true,\n                            columnDefs: columnDefs,\n                            data: data\n                        };\n                        $scope.gridApi.core.refresh();\n                        $scope.gridApi.grid.refresh();\n                    })\n                }\n\n                $scope.selectAllNone = true;\n                $scope.selectAllNoneFields = function () {\n                    $scope.selectAllNone = !$scope.selectAllNone;\n                    _.each($scope.previewGridOptions.columnDefs, function(columnDef){\n                        columnDef.visible = $scope.selectAllNone;\n                        var settings = getCurrentSettingsByName(columnDef.originalName);\n                        settings.removed = !columnDef.visible;\n                    });\n                    $scope.previewSettings.removedColumns = _.countBy($scope.selectedNode.model.get('settings').columns, 'removed').true;\n                    $scope.previewSettings.columns = lastPreviewResponse.descriptor.columns.length - ($scope.previewSettings.removedColumns || 0);\n                    refreshView();\n                };\n                $scope.switchVisibility = function(columnDef){\n                    columnDef.visible = !columnDef.visible;\n                    var settings = getCurrentSettingsByName(columnDef.originalName);\n                    settings.removed = !columnDef.visible;\n                    $scope.previewSettings.removedColumns = _.countBy($scope.selectedNode.model.get('settings').columns, 'removed').true;\n                    $scope.previewSettings.columns = lastPreviewResponse.descriptor.columns.length - ($scope.previewSettings.removedColumns || 0);\n                    refreshView();\n                };\n                $scope.columnsListMenu = {\n                    isOpen: false,\n                    appendTo: angular.element(document.querySelector('.data-preview-title')),\n                    toggleMenu: function(){\n                        $scope.columnsListMenu.isOpen = !$scope.columnsListMenu.isOpen\n                    }\n                };\n\n                function addListCustomFilter(column, data){\n                    switch(column.filter){\n                        case 'financial':\n                            return $filter('financial')(data);\n                        case 'currency':\n                            return column.formatSymbol + $filter('number')(data, (column.decimalPlaces || 0));\n                        case 'number':\n                            return $filter('number')(data, column.decimalPlaces);\n                        case 'percent':\n                            return $filter('number')(data, 2) + '%';\n                        case 'date':\n                            return $filter('date')(data, \"MM/dd/yyyy\");\n                        case 'time':\n                            return $filter('date')(data, \"h:mma\");\n                        case 'datetime':\n                            return $filter('date')(data, \"MM/dd/yyyy HH:mm:ss\");\n                        case 'duration':\n                            return $filter('date')(data, \"HH:mm:ss\");\n                        default:\n                            return data;\n                    }\n                }\n                function refreshListView(){\n                    var start = ($scope.listView.currentPagination - 1) * $scope.listView.maxPerPage;\n                    fillListView(start, (start + $scope.listView.maxPerPage));\n                }\n                function refreshNestedView(){\n                    var start = ($scope.nestedView.currentPagination - 1) * $scope.nestedView.maxPerPage;\n                    fillNestedView(start, (start + $scope.nestedView.maxPerPage));\n                }\n                function fillListView(start, end){\n                    $scope.listView.data = [];\n                    var data = lastPreviewResponse.data.slice(start, end);\n                    _.each(data, function(data){\n                        var item = [];\n                        _.each(lastColumnDefs, function(colDef){\n                            //for xml's\n                            var value = data[colDef.displayName] || data[colDef.originalName];\n                            if(colDef.visible && value){\n                                item.push({name: colDef.displayName, data: addListCustomFilter(colDef, value)});\n                            }\n                        });\n                        if(item.length) {\n                            $scope.listView.data.push(item);\n                        }\n                    });\n                }\n                function fillNestedView(start, end){\n                    $scope.nestedView.data = _.map(lastPreviewResponse.data.slice(start,end), unflatten);\n                }\n                function makePagination(view){\n                    view.pagination = [];\n                    var start = 1;\n                    var end = Math.min(Math.ceil(view.totalSize / view.maxPerPage), 500);\n\n                    view.pagination.push(start);\n                    if (view.currentPagination > start + 3) {\n                        view.pagination.push(\"...\");\n                    }\n                    for (var i = start + 1; i < end; ++i) {\n                        if (Math.abs(i - view.currentPagination) <= 2) {\n                            view.pagination.push(i);\n                        }\n                    }\n                    if (view.currentPagination < end - 3) {\n                        view.pagination.push(\"...\");\n                    }\n                    if (end != start) {\n                        view.pagination.push(end);\n                    }\n                }\n                $scope.switchPaginate = function(view, pag){\n                    view.currentPagination = pag;\n                    makePagination(view);\n                    var start = (view.currentPagination - 1) * view.maxPerPage;\n                    if($scope.currentView == ViewType.LIST) {\n                        fillListView(start, (start + view.maxPerPage));\n                    } else if ($scope.currentView == ViewType.NESTED){\n                        fillNestedView(start, (start + view.maxPerPage));\n                    }\n                };\n                $scope.nestedView = {\n                    data: [],\n                    pagination: [],\n                    currentPagination: 1,\n                    maxPerPage: 10\n                };\n\n                $scope.listView = {\n                    data: [],\n                    pagination: [],\n                    currentPagination: 1,\n                    maxPerPage: 10\n                };\n\n                function unflatten(o){\n                    if(!o) return null;\n                    var result = {};\n                    _.each(o, function(v, k){\n                        // split by not screened dot\n                        var path = common.splitPath(k);\n                        addValueToPath(result, path, v);\n                    });\n                    return result;\n                }\n\n                function addValueToPath(target, path, value){\n                    var key = path[0];\n\n                    var newTarget;\n                    if(!_.isArray(target)){\n                        if(_.has(target, key)){\n                            if(path.length > 1){\n                                newTarget = target[key];\n                            } else {\n                                newTarget = target;\n                            }\n                        } else {\n                            if(path.length > 1){\n                                var m = {};\n                                newTarget = m;\n                                target[key] = m;\n                            } else {\n                                newTarget = target;\n                            }\n                        }\n                    } else {\n                        var m2 = {};\n                        newTarget = m2;\n                        target.push(m2);\n                    }\n\n                    if(path.length > 1){\n                        addValueToPath(newTarget, path.slice(1), value);\n                    } else {\n                        if(!_.isArray(newTarget)){\n                            var o = newTarget[key];\n                            if(o == undefined){\n                                newTarget[key] = value;\n                            } else {\n                                var l = [];\n                                l.push(o);\n                                l.push(value);\n                                newTarget[key] = l;\n                            }\n                        } else {\n                            newTarget.push(value);\n                        }\n                    }\n                }\n\n                $scope.refreshCurrentView = function(viewType) {\n                    if(viewType != undefined) {\n                        $scope.currentView = viewType;\n                    }\n                    if($scope.currentView == ViewType.LIST){\n                        $scope.listView.totalSize = lastPreviewResponse.data.length;\n                        $scope.listView.currentPagination = 1;\n                        makePagination($scope.listView);\n                        fillListView(0, $scope.listView.maxPerPage);\n                    } else if ($scope.currentView == ViewType.NESTED) {\n                        $scope.nestedView.totalSize = lastPreviewResponse.data.length;\n                        $scope.nestedView.currentPagination = 1;\n                        makePagination($scope.nestedView);\n                        fillNestedView(0, $scope.nestedView.maxPerPage);\n                    } else if ($scope.currentView == ViewType.TABLE) {\n                        createTableView(lastPreviewResponse, lastColumnDefs);\n                    }\n                };\n\n                $scope.dateFormatModalSettings = {\n                    column: null,\n                    pattern: null\n                };\n                $scope.showDateFormatModal = function(settings, originalType){\n                    var pattern = settings.type.pattern || (originalType && originalType.pattern);\n                    $scope.dateFormatModalSettings = {\n                        column: settings,\n                        pattern: pattern\n                    };\n                    $scope.dateFormatModal = $uibModal.open({\n                        templateUrl: 'static/templates/include/date-format.html',\n                        scope: $scope,\n                        animation: true,\n                        size: 'sm'\n                    })\n                };\n                $scope.closeDateFormatModal = function(){\n                    $scope.dateFormatModal.dismiss();\n                };\n                $scope.updateDateFormat = function(){\n                    var oldType = angular.copy($scope.dateFormatModalSettings.column.type);\n\n                    $scope.dateFormatModalSettings.column.type = {'@class': 'com.dataparse.server.service.parser.type.DateTypeDescriptor', dataType: 'DATE', pattern: $scope.dateFormatModalSettings.pattern}\n                    $scope.dateFormatModal.dismiss();\n                    $scope.api.preview();\n\n                    var newType = angular.copy($scope.dateFormatModalSettings.column.type);\n                    pushCoerceToType($scope.dateFormatModalSettings.column.name, oldType, newType);\n                };\n\n                $scope.replaceErrorsModalSettings = {\n                    column: null,\n                    typeNameText: null,\n                    replaceErrors: null\n                };\n                $scope.showReplaceErrorsModal = function(settings){\n                    $scope.replaceErrorsModalSettings.column = settings;\n                    $scope.replaceErrorsModalSettings.typeNameText = common.typeNameMappings[settings.type.dataType];\n                    $scope.replaceErrorsModalSettings.replaceErrors = settings.replaceErrors;\n                    $scope.replaceErrorsModal = $uibModal.open({\n                        templateUrl: 'static/templates/include/replace-errors.html',\n                        scope: $scope,\n                        animation: true,\n                        size: 'md'\n                    })\n                };\n                $scope.closeReplaceErrorsModal = function(){\n                    $scope.replaceErrorsModal.dismiss();\n                };\n                $scope.updateReplaceErrors = function(){\n\n                    var oldReplace = $scope.replaceErrorsModalSettings.column.replaceErrors;\n\n                    $scope.replaceErrorsModalSettings.column.replaceErrors = $scope.replaceErrorsModalSettings.replaceErrors;\n                    $scope.api.preview();\n                    $scope.replaceErrorsModal.dismiss();\n\n                    pushUpdateReplaceErrors($scope.replaceErrorsModalSettings.column.name, oldReplace, $scope.replaceErrorsModalSettings.column.replaceErrors);\n                };\n                $scope.deleteReplaceErrors = function(){\n\n                    var oldReplace = $scope.replaceErrorsModalSettings.column.replaceErrors;\n\n                    $scope.replaceErrorsModalSettings.column.replaceErrors = null;\n                    $scope.replaceErrorsModalSettings.replaceErrors = null;\n                    $scope.api.preview();\n                    $scope.replaceErrorsModal.dismiss();\n\n                    pushDeleteReplaceErrors($scope.replaceErrorsModalSettings.column.name, oldReplace, $scope.replaceErrorsModalSettings.column.replaceErrors);\n                };\n\n                $scope.annotationModalSettings = {\n                    column: null,\n                    annotation: null,\n                    oldAnnotation: null\n                };\n                $scope.showAnnotationModal = function(settings){\n                    $scope.annotationModalSettings.column = settings;\n                    if($scope.annotationModalSettings.column.annotation) {\n                        $scope.annotationModalSettings.oldAnnotation = $scope.annotationModalSettings.column.annotation;\n                        $scope.annotationModalSettings.annotation = $scope.annotationModalSettings.column.annotation;\n                    }\n                    else $scope.annotationModalSettings.annotation = undefined;\n                    $scope.annotationModal = $uibModal.open({\n                        templateUrl: 'static/templates/include/preview-annotation.html',\n                        scope: $scope,\n                        animation: true,\n                        size: 'md'\n                    })\n                };\n\n                $scope.convertToListModalSettings = {\n                    column: null,\n                    separator: null,\n                    oldSeparator: null\n                };\n\n                $scope.showConvertToListModal = function(settings){\n\n                    $scope.convertToListModalSettings.column = settings;\n                    if($scope.convertToListModalSettings.column.splitOn) {\n                        $scope.convertToListModalSettings.oldSeparator = $scope.convertToListModalSettings.column.splitOn;\n                        $scope.convertToListModalSettings.separator = $scope.convertToListModalSettings.column.splitOn;\n                    }\n                    else $scope.convertToListModalSettings.separator = ',';\n                    $scope.convertToListModal = $uibModal.open({\n                        templateUrl: 'static/templates/include/convert-to-list.html',\n                        scope: $scope,\n                        animation: true,\n                        size: 'md'\n                    });\n                };\n\n                $scope.closeConvertToListModal = function (settings) {\n                    $scope.convertToListModal.dismiss();\n                };\n\n                $scope.closePreviewAnnotationModal = function(){\n                    $scope.annotationModal.dismiss();\n                };\n\n                $scope.updatePreviewAnnotation = function(){\n                    var oldAnnotation = $scope.annotationModalSettings.column.annotation;\n\n                    $scope.annotationModalSettings.column.annotation = $scope.annotationModalSettings.annotation;\n                    refreshPreviewFromCache();\n                    $scope.annotationModal.dismiss();\n\n                    pushUpdatePreviewAnnotation($scope.annotationModalSettings.column.name, oldAnnotation, $scope.annotationModalSettings.column.annotation);\n                };\n\n                $scope.deletePreviewAnnotation = function(){\n                    $scope.annotationModalSettings.column.annotation = null;\n                    refreshPreviewFromCache();\n                    $scope.annotationModal.dismiss();\n                };\n\n                $scope.updateConvertToList = function() {\n                    $scope.convertToListModalSettings.column.splitOn = $scope.convertToListModalSettings.separator;\n                    $scope.api.preview();\n                    $scope.convertToListModal.dismiss();\n                };\n                $scope.deleteConvertToList = function(){\n                    $scope.convertToListModalSettings.column.splitOn = null;\n                    $scope.api.preview();\n                    $scope.convertToListModal.dismiss();\n                };\n\n                $scope.distinctModalSettings = {\n                    columns: null,\n                    selected: null,\n                    notSelected: null,\n                    selectedColumn: null,\n                    add: function(){\n                        if($scope.distinctModalSettings.selectedColumn) {\n                            _.remove($scope.distinctModalSettings.notSelected, function (col) { return col.name == $scope.distinctModalSettings.selectedColumn.name });\n                            $scope.distinctModalSettings.selected.push($scope.distinctModalSettings.selectedColumn);\n                        }\n                    },\n                    remove: function(column){\n                        _.remove($scope.distinctModalSettings.selected, function(col){ return col.name == column.name });\n                        $scope.distinctModalSettings.notSelected.push(column);\n                        $scope.distinctModalSettings.notSelected = _.sortBy($scope.distinctModalSettings.notSelected, \"id\");\n\n                    }\n                };\n                $scope.showDistinctModal = function(columns, selectedColumnName){\n                    $scope.distinctModalSettings.columns = columns;\n                    $scope.distinctModalSettings.notSelected = [].concat(columns);\n                    $scope.distinctModalSettings.selected = [];\n                    $scope.distinctModalSettings.selectedColumn = _.find($scope.distinctModalSettings.notSelected, function(col){ return col.name = selectedColumnName})\n                    $scope.distinctModalSettings.add();\n                    $scope.distinctModal = $uibModal.open({\n                        templateUrl: 'static/templates/include/preview-distinct.html',\n                        scope: $scope,\n                        animation: true,\n                        size: 'md'\n                    })\n                };\n\n                $scope.closePreviewDistinctModal = function(){\n                    $scope.distinctModal.dismiss();\n                };\n\n                $scope.updatePreviewDistinct = function(){\n                    if($scope.distinctModalSettings.selected.length) {\n                        var columnNames = _.map($scope.distinctModalSettings.selected, function (column) {\n                            return column.name;\n                        });\n                        $scope.addTransform({\n                            title: 'Deduplicate',\n                            '@class': '.table.DeduplicationTransform',\n                            columnNames: columnNames\n                        });\n                    }\n                    $scope.distinctModal.dismiss();\n                    $scope.api.preview();\n\n                    //pushUpdatePreviewDistinct(columnNames, );\n                };\n\n                $scope.setDataFormat = function(settings, filter) {\n                    settings.formatSymbol = null;\n\n                    var oldData = {\n                        filter: angular.copy(settings.filter),\n                        decimalPlaces: settings.decimalPlaces\n                    };\n\n                    if(!filter){\n                        settings.filter = null;\n                        settings.decimalPlaces = null;\n                    } else {\n                        settings.filter = filter;\n                        settings.decimalPlaces = 2;\n                    }\n                    refreshPreviewFromCache();\n\n                    var newData = {\n                        filter: angular.copy(settings.filter),\n                        decimalPlaces: settings.decimalPlaces\n                    };\n\n                    pushSetDataFormat(settings.name, oldData, newData);\n                };\n\n                $scope.formatModalSettings = {\n                    column: null,\n                    type: null,\n                    typeSelected: null,\n                    types: ['', '$', '', ''],\n                    decimalPlaces: null,\n                    decimalPlacesAvailable: _.range(11)\n                };\n                $scope.showFormatModal = function(settings) {\n                    $scope.formatModalSettings.column = settings;\n                    if ($scope.formatModalSettings.column.formatSymbol) {\n                        $scope.formatModalSettings.type = $scope.formatModalSettings.column.formatSymbol;\n                        $scope.formatModalSettings.typeSelected = $scope.formatModalSettings.column.formatSymbol;\n                    }\n                    if($scope.formatModalSettings.column.decimalPlaces)\n                        $scope.formatModalSettings.decimalPlaces = Number($scope.formatModalSettings.column.decimalPlaces);\n\n                    $scope.formatModal = $uibModal.open({\n                        templateUrl: 'static/templates/include/preview-format.html',\n                        scope: $scope,\n                        animation: true,\n                        size: 'sm'\n                    })\n                };\n                $scope.closePreviewFormatModal = function(){\n                    $scope.formatModal.dismiss();\n                };\n                $scope.updatePreviewFormat = function(){\n\n                    var oldFormat = {\n                        formatSymbol: angular.copy($scope.formatModalSettings.column.formatSymbol),\n                        decimalPlaces: angular.copy($scope.formatModalSettings.column.decimalPlaces),\n                        filter: angular.copy($scope.formatModalSettings.column.filter)\n                    };\n\n                    $scope.formatModalSettings.column.formatSymbol = $scope.formatModalSettings.type;\n                    $scope.formatModalSettings.column.decimalPlaces = $scope.formatModalSettings.decimalPlaces == 0 ? '0' : $scope.formatModalSettings.decimalPlaces;\n                    $scope.formatModalSettings.column.filter = 'currency';\n                    refreshPreviewFromCache();\n                    $scope.formatModal.dismiss();\n\n                    var newFormat = {\n                        formatSymbol: angular.copy($scope.formatModalSettings.column.formatSymbol),\n                        decimalPlaces: angular.copy($scope.formatModalSettings.column.decimalPlaces),\n                        filter: angular.copy($scope.formatModalSettings.column.filter)\n                    };\n\n                    pushUpdatePreviewFormat($scope.formatModalSettings.column.name, oldFormat, newFormat);\n                };\n\n                function getPreserveHistoryModalSettings() {\n                    return {\n                        retention: {\n                            value: 1,\n                            period: ['Hour', 'Day', 'Week'/*, 'Month'*/],\n                            selectedPeriod: 'Hour'\n                        }\n                    }\n                };\n\n                $scope.showPreserveHistoryModal = function(settings, m) {\n                    $scope.preserveHistoryModalSettings = getPreserveHistoryModalSettings();\n                    $scope.preserveHistoryModalSettings.column = settings;\n                    $scope.preserveHistoryModalSettings.m = m;\n\n                    var ph = $scope.preserveHistoryModalSettings.column.preserveHistory;\n\n                    if (ph) {\n                        $scope.preserveHistoryModalSettings.retention.value = ph.retention.value;\n                        $scope.preserveHistoryModalSettings.retention.selectedPeriod = ph.retention.period;\n                    }\n\n                    $scope.preserveHistoryModal = $uibModal.open({\n                        templateUrl: 'static/templates/include/preserve-history.html',\n                        scope: $scope,\n                        animation: true,\n                        size: 'md'\n                    });\n\n                };\n\n                $scope.closePreserveHistoryModal = function () {\n                    $scope.preserveHistoryModal.dismiss();\n                };\n\n                $scope.updatePreserveHistory = function () {\n                    var settings = $scope.preserveHistoryModalSettings.column;\n                    settings.preserveHistory = {\n                        retention: {\n                            value: $scope.preserveHistoryModalSettings.retention.value,\n                            period: $scope.preserveHistoryModalSettings.retention.selectedPeriod\n                        }\n                    };\n\n                    $scope.preserveHistoryModalSettings.m.icon = 'fa fa-fw fa-check';\n\n                    $scope.preserveHistoryModal.dismiss();\n                };\n\n                $scope.deletePreserveHistory = function () {\n                    $scope.preserveHistoryModalSettings.m.icon = 'fa fa-fw';\n                    $scope.preserveHistoryModalSettings.column.preserveHistory = null;\n                    $scope.preserveHistoryModal.dismiss();\n                }\n\n                $scope.selectedNode = null;\n                var actualSelectedNode = null;\n                var previewRequestId = null;\n                function serializeGraph(){\n                    return angular.toJson(graph.toJSON());\n                }\n\n                var refreshPreviewFromCache = function(){\n                    var columns = $scope.selectedNode.model.get('settings').columns;\n                    _.each(lastPreviewResponse.descriptor.columns, function(col){ col.settings = _.find(columns, {name: col.name}) });\n                    preparePreviewData(lastPreviewResponse);\n                };\n\n                function doPreview(){\n                    if (!$scope.isPreviewRunning) {\n                        $scope.isPreviewRunning = true;\n                        $http.post('/api/flow/preview', $scope.lastPreviewParams)\n                            .success(function (response) {\n                                preparePreviewData(response);\n                                $scope.isPreviewRunning = false;\n                                if($scope.lastPreviewParams){\n                                    doPreview();\n                                }\n                            })\n                            .error(function (e) {\n                                $scope.isPreviewRunning = false;\n                                //common.showValidationErrors(e);\n                                if($scope.lastPreviewParams){\n                                    doPreview();\n                                }\n                            });\n                        $scope.lastPreviewParams = undefined;\n                    }\n                }\n\n                function doValidate(){\n                    if (!$scope.isValidationRunning) {\n                        if(graph.getElements().length > 0) {\n                            $scope.isValidationRunning = true;\n                            $http.post('/api/flow/validate', $scope.lastValidateParams)\n                                .success(function (data) {\n                                    $scope.errors = data;\n                                    $scope.isValidationRunning = false;\n                                    if($scope.lastValidateParams){\n                                        doValidate();\n                                    }\n                                })\n                                .error(function (e) {\n                                    $scope.isValidationRunning = false;\n                                    common.showError(e);\n                                    if($scope.lastValidateParams){\n                                        doValidate();\n                                    }\n                                });\n                            $scope.lastValidateParams = undefined;\n                        } else {\n                            $scope.errors = [];\n                        }\n                    }\n                }\n\n\n                function setUnloadRestriction() {\n                    if (!$scope.selectedTable.committed || $scope.isIndexChanged) {\n                        window.onbeforeunload = function () {\n                            return \"Data will be lost if you leave the page, are you sure?\";\n                        };\n                    }\n                    else window.onbeforeunload = undefined;\n                }\n\n                $scope.renameIndex = function(){\n                    $scope.updateTable(true);\n                };\n\n                $scope.closeIndex = function(){\n                    $scope.updateTable().then(function(){\n                        $scope.selectedTable = undefined;\n                        HistoryService.clear();\n                        window.onbeforeunload = undefined;\n                        $state.go('main');\n                    });\n                };\n\n                $scope.updateTable = function (nameOnly) {\n                    $scope.isUpdating = true;\n                    var method = 'PUT',\n                        url = '/api/tables/' + $scope.selectedTable.id;\n                    return $q(function(resolve, reject){\n                        if(!nameOnly) {\n                            _.each($('body').find('.html.Link.link'), function (elm) {\n                                $(elm).css({fill: 'transparent', stroke: 'transparent'});\n                            });\n                            html2canvas($elm.find('#worksheet')[0], {\n                                onrendered: function (canvas) {\n                                    var contentBBox = paper.getContentBBox();\n                                    if (contentBBox.width > 0 && contentBBox.height > 0) {\n                                        var ctx = canvas.getContext(\"2d\");\n                                        var delta = 20;\n                                        var x1 = contentBBox.x - delta < 0 ? 0 : contentBBox.x - delta,\n                                            y1 = contentBBox.y - delta < 0 ? 0 : contentBBox.y - delta,\n                                            x2 = contentBBox.x + contentBBox.width + delta > canvas.width ? canvas.width : contentBBox.x + contentBBox.width + delta,\n                                            y2 = contentBBox.y + contentBBox.height + delta > canvas.height ? canvas.height : contentBBox.y + contentBBox.height + delta;\n                                        var width = x2 - x1,\n                                            height = y2 - y1;\n\n                                        // try to keep 2:1 aspect ratio and keep image centered\n                                        if (width > height * 2) {\n                                            // try to extend height if possible\n                                            var errY = (width / 2 - height) / 2;\n                                            if (y1 < errY) errY = y1;\n                                            if (canvas.height - y2 < errY) errY = canvas.height - y2;\n                                            if (errY > 0) {\n                                                y1 -= errY;\n                                                y2 += errY;\n                                            }\n                                        } else {\n                                            // try to extend width if possible\n                                            var errX = (height * 2 - width) / 2;\n                                            if (x1 < errX) errX = x1;\n                                            if (canvas.width - x2 < errX) errX = canvas.width - x2;\n                                            if (errX > 0) {\n                                                x1 -= errX;\n                                                x2 += errX;\n                                            }\n                                        }\n                                        width = x2 - x1;\n                                        height = y2 - y1;\n\n                                        var cut = ctx.getImageData(x1, y1, width, height);\n                                        canvas.width = x2 - x1;\n                                        canvas.height = y2 - y1;\n                                        ctx.putImageData(cut, 0, 0);\n                                        var img = canvas.toDataURL(\"image/png\");\n                                        $scope.selectedTable.previewImage = img && (img.length > 6) ? img : 'data:image/png;base64,';\n                                    } else {\n                                        $scope.selectedTable.previewImage = 'data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACwAAAAAAQABAAACAkQBADs=';\n                                    }\n                                    $scope.selectedTable.flowJSON = serializeGraph();\n                                    $http({\n                                        method: method,\n                                        url: url,\n                                        data: {\n                                            name: $scope.selectedTable.name,\n                                            flowJSON: $scope.selectedTable.flowJSON,\n                                            previewImage: $scope.selectedTable.previewImage\n                                        }\n                                    }).success(function (data) {\n                                        resolve(data);\n                                        $scope.selectedTable.uploads = data.uploads;\n                                        $scope.isUpdating = false;\n                                    }).error(function (e) {\n                                        reject(e);\n                                        common.showError(e);\n                                        $scope.isUpdating = false;\n                                    });\n                                }\n                            });\n                        } else {\n                            $http({\n                                method: method,\n                                url: url,\n                                data: {\n                                    name: $scope.selectedTable.name\n                                }\n                            }).success(function (data) {\n                                resolve(data);\n                                $scope.selectedTable.uploads = data.uploads;\n                                $scope.isUpdating = false;\n                            }).error(function (e) {\n                                reject(e);\n                                common.showError(e);\n                                $scope.isUpdating = false;\n                            });\n                        }\n                    });\n                };\n                $scope.dropdownMenu = {\n                    status: false,\n                    mouseOverButton: false,\n                    mouseOverList: false,\n                    toggle: function () {\n                        if (!$scope.dropdownMenu.mouseOverButton) {\n                            $scope.dropdownMenu.mouseOverButton = true;\n                            $timeout(function () {\n                                if (!$scope.dropdownMenu.status && $scope.dropdownMenu.mouseOverButton)\n                                    $scope.dropdownMenu.status = true;\n                            }, 500)\n                        }\n                    },\n                    close: function () {\n                        $timeout(function () {\n                            if (!$scope.dropdownMenu.mouseOverButton && !$scope.dropdownMenu.mouseOverList)\n                                $scope.dropdownMenu.status = false;\n                        }, 1000)\n                    }\n                };\n\n                WSocket.subscribe('/upload-events', function(e){\n                    var node = _.find(graph.getElements(), function(elm) {\n                        return e.file.type && e.file.type != 'composite-ds' && _.contains(elm.get('settings'), e.file.id);\n                    });\n                    if(node) {\n                        switch (e.type) {\n                            case 'DELETE_FILE':\n                                node.remove();\n                                break;\n                            case 'EDIT_FILE':\n                                node.get('view').label = e.file.name;\n                                node.findView(paper).updateBox();\n                                break;\n                        }\n                    }\n                });\n                $scope.viewMode = false;\n                $scope.$watch('viewMode', function(val){\n                    if(val){\n                        window.onbeforeunload = undefined;\n                        $state.go('main.visualize', {id: $scope.selectedTable.id})\n                    }\n                });\n\n                $scope.$on('add-source', function(event, params){\n                    $scope.api.nodes.addSources(params.uploads);\n                });\n\n                $scope.onWorkspaceResize = function(){\n                    $scope.api.resize($localStorage.workspaceH);\n                };\n\n                /// INITIALIZE\n                HistoryService.clear();\n                $(document).scrollTop(0);\n                $(window).resize(function(){\n                    $scope.api.resize();\n                });\n\n                var indexes = DatadocService.getList();\n                $scope.selectedTable = _.find(indexes, {id: parseInt($stateParams.id)});\n                $scope.api.load($scope.selectedTable);\n                if($stateParams.new) {\n                    $location.search('new', null).replace();\n                    $timeout(function () {\n                        $elm.find('#status-bar').find('.form-control.selected').select()\n                    });\n                }\n            }\n        }\n    }])\n});\n\n"]}