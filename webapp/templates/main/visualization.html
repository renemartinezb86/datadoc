<div class="disable-page" ng-if="isCommitRunning() && isIngestMode()"
     tabindex="-1"
     uib-tooltip="The section cannot be modified while ingesting your data"
     tooltip-placement="mouse-top"
     tooltip-trigger="'click'"
     tooltip-class="unmodifiable-section-tooltip main-page-tooltip">
</div>
<div class="navbar-wrapper" ng-class="isVizMode() ? 'viz-navbar-wrapper' : 'ingest-navbar-wrapper'">
    <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
        <div class="navbar-header viz-navbar-header">
            <a class="navbar-brand" ui-sref="main.landing.my_data"></a>
        </div>
        <search-bar ng-if="isVizMode()">
            <dropdown-options>
                <search-settings-dropdown></search-settings-dropdown>
            </dropdown-options>
        </search-bar>
        <div class="flex-spacer"></div>
        <div class="general-settings">
            <user-menu></user-menu>
            <div class="share" ng-show="isVizMode() && !isViewOnly">
                <button class="btn btn-primary btn-sm share-button" ng-click="openShareModal()"
                        uib-tooltip-html="shareWithDatadocMessage()"
                        tooltip-placement="bottom"
                        tooltip-popup-delay="250"
                        tooltip-is-open="true"
                        tooltip-enable="true"
                        tooltip-class="share-tooltip">
                    <span class="share-icon"></span> Share
                </button>
            </div>
            <datadoc-presence
                    class="presence-widgets"
                    presence-users="datadocViewers"
                    ng-if="isVizMode()">
            </datadoc-presence>
        </div>
    </nav>
</div>

<div id="wrapper" class="ng-isolate-scope viz-page">

    <div class="viz-status-bar" static-include="static/templates/include/viz-pages/viz-status-bar.html"></div>
    <div class="viz-status-bar" static-include="static/templates/include/viz-pages/ingest-status-bar.html"></div>

    <div id="page-content-wrapper" ng-class="isVizMode() ? 'viz-content-wrapper' : 'ingest-content-wrapper'">
        <div class="page-content">


            <div static-include="static/templates/include/viz-pages/viz.html"></div>
            <div static-include="static/templates/include/viz-pages/ingest.html"></div>

            <div id="tabs-bar">
                <div id="toggle-widgets"
                     ng-if="!isViewOnly"
                     uib-tooltip="Your must first save your data to apply Filters"
                     tooltip-enable="!isVizMode() && !ingestDataSummary.queryMode"
                     tooltip-placement="top"
                     tooltip-popup-delay="250"
                     tooltip-append-to-body="true"
                     tooltip-class="main-page-tooltip">
                    <button type="button"
                            ng-click="toggleRightFilters()"
                            ng-disabled="(isIngestMode() && !isShowTables()) || isMobileView()"
                            ng-class="{'active': isShowFilters, 'disabled': (isIngestMode() && !isShowTables()) || isMobileView()}">
                        <i class="fa fa-filter"></i> {{isIngestMode() && isShowTables() ? 'Tables' : 'Filters'}}
                    </button>
                </div>
                <div id="tabs-bar-content">
                    <div class="inline-block dropup pull-left add-tab-wrapper" ng-if="!isViewOnly" uib-dropdown>

                        <div class="tab-button add-tab-button"
                             ng-click="tabsSection.addNewTab()"
                             uib-tooltip="Add Sheet"
                             tooltip-placement="top"
                             tooltip-popup-delay="250"
                             tooltip-append-to-body="true"
                             tooltip-class="main-page-tooltip">
                            <span>+</span>
                        </div>

                        <ul class="dropdown-menu tabs-dropdown" style="left: 0; right: auto" uib-dropdown-menu role="menu">
                            <li role="menuitem"><a ng-click="tabsSection.addNewTab()">Create New</a></li>
                            <li role="menuitem"><a ng-click="tabsSection.duplicateTab(false)">Duplicate Sheet</a></li>
                        </ul>
                    </div>
                    <div id="tabs-list-wrapper"
                         sv-root
                         sv-part="tabsSection.options.tabs"
                         sv-only-x
                         sv-not-leave
                         sv-on-sort="tabsSection.moveTabForServer($item, $indexTo)"
                         sv-on-start="tabsSection.onMoveStart($item)"
                         sv-on-stop="tabsSection.onMoveStop($item)">
                        <div class="left-shadow hidden">
                            <div class="fade fade-40 pull-right"></div>
                            <div class="fade fade-62 pull-right"></div>
                            <div class="fade fade-82 pull-right"></div>
                        </div>
                        <div id="tabs-list"
                             ng-class="{'sorting': tabsSection.options.move}">
                            <div uib-tooltip="Tab not yet processed."
                                 tooltip-enable="isForbiddenTab(tab)"
                                 tooltip-placement="top"
                                 tooltip-append-to-body="true"
                                 tooltip-popup-delay="250"
                                 tooltip-class="main-page-tooltip"
                                 ng-repeat="tab in tabsSection.options.tabs"
                                 class="single-tab-wrapper">
                                <div class="single-tab dropup pull-left"
                                     ng-class="{'active': tab.active, 'saving': isCommitRunning(tab.id)}"
                                     ng-click="tabsSection.setActiveTab(tab, false, true)"
                                     ng-disabled="isForbiddenTab(tab)"
                                     uib-dropdown
                                     dropdown-append-to-body="true"
                                     is-open="tab.dropdownOpened"
                                     click-out="tabsSection.closeInputOnTab(tab)"
                                     sv-without="['ul.tabs-dropdown']"
                                     sv-element>
                                <span ng-dblclick="tabsSection.renameTab(tab, $index, $event)"
                                      ng-style="{'opacity': tab.editable ? 0 : 1,
                                              'position': tab.editable ? 'absolute' : 'relative',
                                              'visibility': tab.editable ? 'hidden' : 'visible'}"
                                      ng-attr-id="{{snakeCase(tab.name)}}_{{$index}}" ng-bind-html="tab.name"
                                      class="no-overflow"></span>
                                    <span ng-show="isCommitRunning(tab.id) && !tab.editable"
                                          style="color: #999; margin-left: 7px">({{commitProgress.getShortText(tab.id)}})</span>
                                    <input type="text" ng-model="tab.name" ng-show="tab.editable"
                                           ng-mousedown="$event.stopPropagation()"
                                           ng-keyup="tabsSection.inputKeyPress($event, tab, $index)"
                                           limit-to="50" pu-elastic-input/>
                                    <i class="fa fa-caret-down" style="margin-left: 5px"
                                       ng-mousedown="onTabsDropdownToggled($event, tab)"
                                       ng-click="$event.stopPropagation();" ng-disabled="!tab.active"></i>
                                    <ul class="dropdown-menu tabs-dropdown" uib-dropdown-menu role="menu">
                                        <li role="menuitem"><a
                                                ng-click="tabsSection.deleteTab(tab, $index, $event)">Delete</a>
                                        </li>
                                        <li role="menuitem"><a
                                                ng-click="tabsSection.renameTab(tab, $index, $event)">Rename</a>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="right-shadow hidden">
                            <div class="fade fade-40 pull-left"></div>
                            <div class="fade fade-62 pull-left"></div>
                            <div class="fade fade-82 pull-left"></div>
                        </div>
                    </div>
                    <div id="tabs-arrows" class= "inline-block hidden">
                        <button type="button" class="tab-button" ng-click="moveTabs('left')"><i class="fa fa-arrow-left"></i></button>
                        <button type="button" class="tab-button" ng-click="moveTabs('right')"><i class="fa fa-arrow-right"></i></button>
                    </div>
                    <div class="clearfix"></div>
                </div>
            </div>
        </div>
    </div>

    <ng-include src="'static/templates/include/chart-tooltip.html'"></ng-include>

</div>